<html>
<head>
  <title>Help for Deadly Rooms of Death</title>
</head>
<body bgcolor="#FFFFFF">
<img src="images/drodlogo.jpg" />
<hr />
<h3><u>Character Script Commands</u></h3>
<p>When the player enters the room, NPCs start performing the behavior you
designate.  There are four general classes of script commands, as follows:</p>
<ol>
  <li><a href="#placement">Placement</a></li>
  <li><a href="#condition">Condition</a></li>
  <li><a href="#interaction">Interaction</a></li>
  <li><a href="#queries">Queries</a></li>
  <li><a href="#decision">Decision making</a></li>
</ol>
<p>
<a href="#usagenotes">Notes about using NPC scripts</a><br />
<a href="#imperativelist">Imperatives</a><br />
<a href="#behaviorlist">Behaviors</a><br />
<a href="#functions">Function Primitives</a><br />
<a href="#branchingexamples">Examples of branching code structures</a><br />
<a href="#commandkeyexample">Example of using the Special Command key</a><br />
<a href="#world-map-command-ex">Example of using World Map commands</a><br />
<a href="#predefined-script-vars">Predefined script vars</a><br />
<a href="#threatclockdisplay">Threat clock display modes</a><br />
<a href="#playerinputvars">List of player command input variables</a><br />
<a href="#image-overlay-commands">Image Overlay commands</a><br/>
<a href="#myscript-injection">_MyScript variable injections</a>
</p>
<hr />

<p><a name="placement"><b>1.&nbsp;&nbsp;Placement</b></a> - Change the NPC's location.</p>
<ol>
  <li><a name="appear"><b>Appear</b></a> - If not visible, the NPC will appear
      at the current square (i.e. it enters the room).  This command does
      nothing if the NPC is already visible. If a monster or the player occupies
      the square it is appearing in, then the NPC will wait until the square is
      vacant to appear.</li>
  <li><a name="appearat"><b>Appear at</b></a> - Use this to have an invisible
      NPC enter the room at a designated square different from the one where the
      NPC is current located. After selecting this command, the room will
      temporarily appear.  Click on a square to select where the NPC will enter
      the room. This command does nothing if the NPC is already visible.  If a
      monster or the player occupies the square the NPC is to appear in, it will
      wait until the square becomes vacant to appear.</li>
  <li><a name="disappear"><b>Disappear</b></a> - Removes the NPC from the room,
      making him invisible. Use this to show an NPC leaving the room. Script
      commands continue to play while the character is invisible but the NPC
      will not physically interact with any room elements unless it Appears
      again.</li>
  <li><a name="moveto"><b>Move to</b></a> - The NPC will move to the indicated
      square (selected by clicking on a room square, as above).  Optionally, one
      of the entity types listed in the adjacent list box may be selected as who
      the NPC should follow. Hold &lt;Ctrl&gt; while clicking to select and
      unselect multiple selections. Each turn, the NPC will attempt to move one
      square closer to its destination. It moves roughly in a straight line and
      won't move on a given turn if something is in its way.
      <a name="forbidturning">Enable</a> "Forbid turning" if you don't want the
      monster turning to face the direction it is moving each step. Hint: If you
      want the NPC to move in a more complex fashion, such as following a
      twisting corridor, this can be accomplished with a sequence of <b>Move
      to</b> commands, one to navigate each twist in the corridor.  This command
      finishes when the NPC arrives at the destination square.
      <a name="singlestep">Enable</a> "Single step" to have the NPC only attempt
      to make a single step toward the indicated destination before continuing
      to the next script command.  If no move can be made character will wait instead
	  and the next script command will run on the next turn.</li>
  <li><a name="move"><b>Move</b></a> - Similar to <a href="#moveto"><b>Move
      to</b></a>, except a relative number of tiles to move from the NPC's
      current location is specified.  Positive numbers indicate movement south
      and east, and negative numbers are for moving north and west.</li>
  <li><a name="facedirection"><b>Face direction</b></a> - Initially, the NPC
      faces the direction it is oriented when placed in the room.  Use this
      command to turn the NPC in a different direction without moving (takes 1
      turn).</li>
  <li><a name="face-towards-like-guard"><b>Face towards like guard</b></a> - Use this command to make the NPC change the direction they're facing towards a given point or entity just as the guard would.<br/>
      <a name="face-towards-like-guard-single-step"><u>Single step</u></a>: Setting this to <i>on</i> will make the character slowly turn towards the target direction. <i>Off</i> will make it turn immediately, just as <i>face direction</i> does.<br />
      <a name="face-towards-like-guard-targets"><u>Targets</u></a>: You can select zero, one or multiple targets from the list of entity groups - ctrl+click to deselect/select multiple. If no group is selected you will be asked to select a tile towards which the NPC should face.<br />
      <a name="face-towards-like-guard-conditions"><u>Using in conditions</u></a>: This command can be used with <a href="#if">if statements</a> to check if the character is already facing the target direction.
	</li>
  <li><a name="teleport-to"><b>Teleport to</b></a> - Instantly moves the NPC
      to the indicated tile, as long as another entity is not occupying it.</li>
  <li><a name="teleport-player-to"><b>Teleport player to</b></a> - Instantly moves the player to the indicated tile processing all interactions: player will drown or fall into pit, potions will be drunk,
      the weapon will stab, pressure plates will toggle, etc. <br/>
      <a name="teleport-player-to-potions"><u>Interactions with potions</u></a>: If the player is teleported multiple time during a single turn and they happen to land on one or more blocking potions (mimic, decoy and clone) then only the first of these potions will be consumed. However if the blocking potion is followed by non-blocking ones (invisiblity, speed, horns) they will be drunk. Horns are considered potions by the game. Avoid using this obscure mechanic in puzzles.<br />
      <a name="teleport-player-to-blocked-teleport"><u>Blocked teleports</u></a>: This command will be silently ignored if you try to teleport the player: onto another monster/entity which can't be killed by stepping, to a location outside the room boundaries, onto the tile currently occupied by the player.<br />
      <a name="teleport-player-to-temporal-split"><u>Temporal recording</u></a>: If the player gets teleported the quantum flux will reset and stop the temporal recording.<br />
      <a name="teleport-player-to-consequences"><u>Monsters on target tile</u></a>: You can teleport onto a monster and instantly kill it if you are currently capable of killing that monster by stepping onto it. You can't teleport onto monsters that leave a pile behind, just like you can't step on them in the Slayer role or while wielding a dagger (in case of the dagger it's the stab that kills, you don't actually end up moving onto their space).<br />
    </li>
</ol>

  <p>
    <a name="condition"><b>2.&nbsp;&nbsp;Condition</b></a> - How the NPC
    functions.</p>
  <ol>
    <li><a name="setappearance"><b>Set appearance</b>
      </a> - Changes the NPC's "Graphic" and default properties to the specified entity type.</li>
      <li><a name="set-movement"><b>Set movement type</b></a> - Changes which tiles the NPC can move on. By default, an NPC with a movement type that would normally prevent it from moving over "ground" tiles can still move other these tiles. By using the <a href="#beh-restricted-movement">Restricted Movement</a> behavior, this can be prevented. The options are:
      <ol>
	    <li><b>Ground</b> - Normal movement behavior. The NPC cannot cross tiles that block normal movement, including shallow water.</li>
	    <li><b>Ground and Shallow Water</b> - Like <b>Ground</b>, except that the NPC can wade in shallow water, and will not drown if dropped into shallow water.</li>
	    <li><b>Water</b> - The NPC can move over both types of water tile. Additionally, the NPC will not drown if dropped into water. If the NPC has the <a href="#beh-restricted-movement">Restricted Movement</a> behavior, the NPC cannot move over non-water tiles.</li>
	    <li><b>Wall</b> - The NPC can move through wall and doors tiles.  If the NPC has the <a href="#beh-restricted-movement">Restricted Movement</a> behavior, the NPC cannot move over any other tiles.</li>
	    <li><b>Air</b> - The NPC can move over all non-wall and non-door tiles. Additionally, it is not damaged by Hot Tiles or Floor Spikes, and cannot be killed by being dropped into water or into pits.</li>
      </ol>
	  Changing an NPC's appearance with <a href="#setappearance">Set appearance</a> will change the movement type to that appearance's default movement type unless the <b>Keep Behaviors</b> option is set to on.
    </li>
    <li><a name="turnintomonster"><b>Turn into monster</b>
      </a> - Turns the NPC into a regular monster of the type indicated by its graphic.
      This ends script execution immediately and the NPC is permanently replaced by a regular monster.</li>
    <li><a name="imperative"><b>Imperative</b></a> - Sets a special status
      condition on the NPC (see <a href="#imperativelist">Imperatives</a>).
      Compatible imperatives may be combined.</li>
    <li><a name="behavior"><b>Behavior</b></a> - Turn various NPC interactions on
      and off. Some appearances have behaviors set by default.
      Behaviors may be combined. (see <a href="#behaviorlist">Behaviors</a>).</li>
	<li><a name="replacewithdefault"><b>Replace with Default Script</b></a> - If the NPC is a custom NPC type, replaces the script content with that NPC type's default script. That script will then begin executing. Has no effect when used in an NPC with a pre-defined type.</li>
  </ol>

<p><a name="interaction"><b>3.&nbsp;&nbsp;Interaction</b></a> - How the NPC
interacts with its environment.</p>
<ol>
  <li><a name="activateat"><b>Activate item at</b></a> - Activates the item at
      the room square you select. Items that can be activated are: orbs,
      pressure plates, lights and wall lights. Nothing will happen this turn if
      no relevant item is at the indicated square. Hint: Move the character next
      to orbs before striking them for more intuitive behavior.  If no one is
      next to the orb when struck, it will appear that Beethro is using his
      portable orb.</li>
  <li><a name="speech"><b>Speech</b></a> - Causes someone in the room to say
      something.<br />
      <a name="dialogtext"><u>Dialog text</u></a>: Type the words that are said.
      This may be left blank in order to only play a sound effect.<br />
      <a name="speaker"><u>Speaker</u></a>: who says the words. The text appears
      next to the person's figure in the room and their face appears on screen
      while they are speaking.  Use "Custom" to have the NPC "throw its voice"
      to a different square in the room.  If a monster or character is located
      at the indicated square when this command is executed, it will appear as
      if this monster or character is speaking. If speaker is set to "None", or
      the person indicated is not present in the room, then the words will
      appear next to the NPC.<br />
      <a name="mood"><u>Mood</u></a>: the face displays the indicated mood.  Not
      all moods are available for all speaker types.<br />
      <a name="speechdelay"><u>Speech delay</u></a>: How long, in milliseconds,
      the speech lasts for.  If placing multiple lines of speech in sequence,
      this determines how much time passes until the next line of speech (and
      corresponding speaker) is displayed.  Set this value to zero to have the
      game engine calculate how long to wait based on the length of the speech
      text.<br />
      <a name="addsound"><u>Add sound</u></a>: A sound file (Wave or Ogg Vorbis
      format) on disk can be optionally attached to the speech.  If a sound is
      specified, it will play along with the text and the next speech command
      will be played when the sound completes. Use a non-zero speech delay to
      force when the next line of speech will play regardless of how long the
      attached sound file plays.<br />
      <a name="exportspeech"><u>Exporting speech text</u></a>: A hold's entire
      speech script can be exported to an HTML file on disk when exporting the
      hold by adding the line "ExportSpeech=1" to the "[Startup]" section of
      Data/drod.ini.
  </li>
  <li><a name="flushspeech"><b>Flush Speech (on/off)</b></a> - Tells the game to
      immediately process any previously queued speech that hasn't had time to
      play yet.  If "On" is selected, these texts will appear immediately
      onscreen.  If "Off" is selected, then text that hasn't played yet won't
      show at all. Hint: This command is used for dramatic effect, to ensure
      speech queued after this command will be immediately spoken, as intended.
      This command is not needed if it doesn't matter at what point in play
      speech texts are delivered.</li>
  <li><a name="ambient"><b>Ambient sound</b></a> - Plays a custom sound effect,
      imported from a sound file on disk.  Select "Loop Off" to play the sound
      once, and "Loop On" to play the sound repeatedly.  Selecting no sound file
      in conjunction with this command will silence any ambient sounds playing
      when the command is executed.</li>
  <li><a name="ambientat"><b>Ambient sound at</b></a> - Plays a custom sound
      effect, imported from a sound file on disk, from the room location you
      specify.  The sound will play from the direction the sound is coming to
      the player in the room and will be quieter the further the player is away
      from that room tile.  Selecting no sound file in conjunction with this
      command will silence any ambient sounds currently playing at the room
      location you specify.</li>
  <li><a name="buildmarker"><b>Build marker</b></a> - Mark a region of the room
      for building a certain object by citizen builders.  When a builder builds
      on a tile, the tile is unmarked. Each room tile can be marked only by a
      single object type at a time. Selecting "None" unmarks any existing build
      markers in the room region you specify.</li>
  <li><a name="build"><b>Build</b></a> - Instantly build the indicated object in
      the specified room region. You may also remove objects from the specified
      room layer.</li>
  <li><a name="destroy-trapdoor"><b>Destroy trapdoor</b></a> - Causes a trapdoor
      at the indicated location to drop down.</li>
  <li><a name="gotoentrance"><b>Go to level entrance</b></a> - Sends the player
      immediately to any level entrance defined in the hold, or ends the hold.</li>
  <li><a name="attacktile"><b>Attack tile</b></a> - Executes an attack of the designed damage type to the designated tile.</li>
  <li><a name="pushtile"><b>Push tile</b></a> - Executes an push in the designed direction type on the designated tile.</li>
  <li><a name="playvideo"><b>Play video</b></a> - Plays a video file, imported
      from a video file on disk, at the specified screen coordinates.  Sound
      tracks in video files are not supported, but sounds and music may be
      played concurrently with the proper script commands.
      <a name="supportedvideo">Currently</a>, only Ogg Theora video format is
      supported.</li>
  <li><a name="setmusic"><b>Set music</b></a> - Set any of the available music
      themes to play. Additionally, custom music, imported from a music file on
      disk, may be played. Only Ogg Vorbis and Wave formats are supported.
      Custom music can be set to continue playing across rooms by executing this
      command on room entrance.</li>
  <li><a name="role"><b>Player role</b></a> - Indefinitely sets the player to
      play the role you indicate. In these roles, properties that apply to that
      entity type generally hold.</li>
  <li><a name="setplayerstealth"><b>Set player stealth</b></a> - Change the player's stealth property on room entrance to the indicated value indefinitely.</li>
  <li><a name="setplayerweapon"><b>Set player weapon</b></a> - Change the player's current weapon type, or enable or disable wielding a weapon indefinitely.</li>
  <li><a name="cutscene"><b>Cut scene</b></a> - When set, room turns will
      proceed automatically at the rate you specify without player intervention.
      Invoke this command with a rate of "0" to end the cut scene and return
      movement control to the player. Hint: This command is used for dramatic
      effect, to have NPCs do things, such as move around the room, without
      requiring the player to take turns to allow the NPCs to likewise move.
      If on a given turn no NPCs are executing, the cut scene playing will
      automatically terminate, restoring control to the player.</li>
  <li><a name="answer"><b>Answer option</b></a> - Provides a multiple choice
      option for a <a href="#question"><b>Question</b></a> command (see below).
      A label from the list of defined <a href="#label"><b>Label</b></a>
      commands in the script must be selected as the point from where the script
      will continue execution if the user selects this choice.
      Up to nine answer options are supported for a given Question.  Any
      additional options are ignored.</li>
  <li><a name="setvar"><b>Set var</b></a> - Each hold you create contains a set
      of zero or more variables, named by you.  Use these variables to track
      persistent game state information across rooms during play. To add a variable
      to a hold, type its name into the uppermost text box and click "Add".<br />
	 <u>Syntax</u>: Variable names must begin with a letter or period and not contain any punctuation
	  except underscore ('_').  <a href="localvars">Starting</a> a variable name with a period ('.') configures it as a local variable instead of a global. This means each NPC will have its own version of a variable with this name and there is no value sharing among them.<br />
      <u>Modifying variables</u>: <a name="varops">Select</a> a hold variable from the list, choose an
      operation and a value. Variables may either store an integer or text. If
      the operation you specify is "Assign text" or "Add text", the variable you
      select will be set to store the text you provide. You may also reference
	  other variables to insert into the given text.  For operations dealing
      with numbers, if you provide the name of another variable, its value will
      be used (invalid names will be considered a value of 0). Otherwise, the
      number you provide is used. Use the text box on top to specify the text
      being assigned or added to the variable. For other operations, use the
      text box on the right to input a number or variable name. The variable
      will store a number.<br />
      <a name="varsintext"><u>Using variables in text</u></a>:
    In variable text assignments,
    <a href="#speech">Speech</a>, <a href="#question">Questions</a>
      (see below), level entrance texts, and scroll text,
      type "$&lt;var name&gt;$" to insert the
      current value of the variable you name at this point in the text.
	  Type "$\n$" to skip to the next line of text.<br />
      <a name="varref"><u>Comprehensive variable reference list</u></a>:
      In the <a href="editroom.html">Room Editor Screen</a>, press F2 to output
      a comprehensive list of hold variables to the clipboard (use the paste
      option of your favorite text editor to view this text). This list shows
      all rooms and NPC (x,y) locations where the variable is referenced in a
      script throughout the hold. A number after the (x,y) location of the
      script indicates how many times the variable is referenced in that script.<br />
      <a name="varmonitor"><u>Monitoring variables during play</u></a>:
      Press Ctrl-F7 while playing to turn on and off the variable monitor.
      Whenever a script changes a hold variable, you will be notified onscreen.
      This only works while playtesting, playing a hold you authored, or playing
      a CaravelNet hold in beta.<br />
      <u>Deleting variables</u>: To permanently remove a hold variable, select it from the list box on the
      left and click "Remove".  Note that this removes the variable completely
      from the hold and all NPC scripts that use it, not just from this
      particular script.<br />
</li>
  <li><a name="setshallowwatertraversal"><b>Set shallow water traversal</b>
    </a> - Sets how and under what conditions the player interacts with shallow water terrain.</li>
  <li><a name="gameeffect"><b>Game effect</b>
  </a> - Display a visual effect at a specified room location.  Particle effects may have a direction
    given them.  Some effects may play an optional accompanying sound effect.</li>
  <li><a name="image-overlay"><b>Image overlay</b></a> - Input a <a href="#image-overlay-commands">custom set of commands</a> for displaying a custom image effect in the game room.</li>
  <li><a name="generateentity"><b>Generate entity</b>
    </a> - Creates a new
    entity of the specified type at room location (x,y) and the indicated
    orientation once that room tile is vacant.  Custom NPCs with a default
    script defined may be created where an entity already occupies the room tile,
    but begins as not visible.
    NPCs will begin executing their default script when created.</li>
  <li><a name="startglobalscript"><b>Start global script</b>
    </a> - Begin executing the specified NPC's default script.
    To use this command, first create a custom NPC role, then give it a default script.
    The global script will automatically run in each room you enter for the rest of the campaign, until an <a href="#end">End</a> command or variant is executed.
    Only one instance of each custom NPC may be run as a global script while in any given room.</li>
  <li><a name="displayfilter"><b>Display filter</b>
  </a> - Display the room with the indicated graphic filter.</li>
  <li><a name="flashingmessage"><b>Flashing message</b>
  </a> - Flash a message onto the room area.  By default, the text is displayed in bright yellow. You may specify an alternate color by providing a six-character RGB hexadecimal code, with each two-character pair indicating a color value between 0 and 255.</li>
  <li><a name="challenge"><b>Challenge</b></a> - Used for the CaravelNet achievement/trophy system. When executed, this indicates that a challenge with the given name has been completed by the player.</li>
  <li><a name="world-map-select"><b>World Map Select</b></a> - Select an overworld map for subsequent World Map commands to be performed with reference to. Without this command, the other World Map commands will do nothing.</li>
  <li><a name="world-map-music"><b>World Map Music</b></a> -
Sets the music that plays on the previously selected map. This only need be executed once during a hold playthrough. Any subsequent executions will override the previous setting.</li>
  <li><a name="world-map-tile-icon"><b>World Map Tile Icon</b></a> - Places an icon on the previously selected map. You specify the position the icon appears on the map, its state, and if active, what level entrance or map it leads to when the player clicks on it from this map screen. Icons persist on the specified map from that moment for the entire playthrough. Placing an icon at the same position as another will override the first. Using icon type "Off" will remove an icon from the map. You can select a custom NPC with a looping animation speed in order to display an animated graphic on the map.</li>
  <li><a name="world-map-image-icon"><b>World Map Image Icon</b></a> - Places an image on the previously selected map. Works in other respects as the "World Map Tile Icon" command.</li>
</ol>

<p><a name="queries"><b>4.&nbsp;&nbsp;Queries</b></a> - Use queries to examine
the state of the room and wait indefinitely until certain events occur.</p>
<ol>
  <li><a name="question"><b>Question</b></a> - If one or more <a href="#answer">
      <b>Answer option</b></a> commands have been provided previously in script
      execution, this will ask the user a multiple choice question with the
      dialogue you specify and answer options previously provided. Script
      execution will continue from the label of the Answer option selected by
      the player.  Once a <b>Question</b> has been asked, the list of Answer
      options is reset for the next <b>Question</b>.<br />
      If no <a href="#answer"><b>Answer option</b></a> commands have been
      provided before this command is executed, the user will be asked a "Yes"
      or "No" question with the dialogue you specify. If a yes/no
      <b>Question</b> is executed as the condition for an <a href="#if">
      <b>If ...</b></a> command, the corresponding script block will execute if
      the user answers "Yes".</li>
  <li><a name="istileopen"><b>Is tile open</b></a> - Check whether the indicated tile is open for the NPC to move to from its current location.</li>
  <li><a name="wait"><b>Wait</b></a> - This tells the NPC to do nothing until
      the number of game turns you specify has passed.  <b>Wait 0</b> will stop
      the script at the current point until the next turn.</li>
  <li><a name="waitevent"><b>Wait for event</b></a> - The NPC waits until the
      specified game event has taken place.</li>
  <li><a name="waitentity"><b>Wait for entity</b></a> - The NPC waits for any of
      the selected entity type (or entities) to enter the room region you
      specify.  Hold &lt;Ctrl&gt; while clicking to select and unselect multiple
      selections.  After selecting this command, the room will temporarily
      appear.  Hold down the mouse button and drag the mouse cursor to select
      the area any of the entity or entities must enter before the NPC does
      anything else.</li>
  <li><a name="waitentityis"><b>Wait while entity</b></a> - Wait while any of
      the selected entity type remains in the room region that you select.</li>
  <li><a name="waitdoor"><b>Wait for door to (open/close)</b></a> - Waits for
      the door at the selected room square to either open or close.</li>
  <li><a name="waitturn"><b>Wait for turn</b></a> - The NPC does nothing until
      at least the specified number of game turns has passed since the player
      entered the room.</li>
  <li><a name="waitclean"><b>Wait for clean room</b></a> - Waits until the room
      is in a conquer-ready state (i.e. all kill-required monsters have been
      removed).</li>
  <li><a name="waitcleanlevel"><b>Wait for clean level</b></a> - Waits until the level
      has been cleared (i.e. all required rooms have been
      cleared).</li>
  <li><a name="wait-for-entity-type"><b>Wait for Entity Type</b></a> - Wait for a specific entity type to be present in a specified room region.</li>
  <li><a name="wait-while-entity-type"><b>Wait while Entity Type</b></a> - Wait while a specific entity type is present in a specified room region.</li>
  <li><a name="wait-for-remains"><b>Wait for monster remains</b></a> - Wait for the remains of a specific entity type to be present in a specified room region.</li>
  <li><a name="waitplayerface"><b>Wait for player to face</b></a> - Waits until
      the player turns in the specified direction.</li>
  <li><a name="waitplayerinput"><b>Wait for player to input</b></a> - Waits until the player inputs the specified command.</li>
  <li><a name="waitplayermove"><b>Wait for player to move</b></a> - Waits until
      the player moves in the specified direction.</li>
  <li><a name="waitplayertouch"><b>Wait for player to touch me</b></a> - Waits
      until the player bumps into the NPC.</li>
  <li><a name="waitnobuildmarkers"><b>Wait for no building markers</b></a> -
      Waits until no script-defined <a href="#buildmarker">building markers</a>
      exist in the room region you specify.</li>
  <li><a name="waitvar"><b>Wait until var</b></a> - Waits until a <a href="#setvar">
      hold variable</a> meets the condition you specify.</li>
  <li><a name="waitweapon"><b>Wait for Weapon</b></a> - Waits until a weapon is in the specified square. By default, this command
      checks for any weapon, but specific weapons can be waited for instead. Hold &lt;Ctrl&gt; while clicking to select and unselect multiple
      selections.</li>
  <li><a name="waitforitem"><b>Wait for item</b>
    </a> - Wait until the specified element is located in the marked room region.</li>
	 <li><a name="get-natural-target"><b>Get natural target</b></a> - Finds the position of the entity this character would target if it was a monster and stores it in two global variables, <b>_ReturnX</b> and <b>_ReturnY</b>.<br/>
      <a name="get-natural-target-targeting-type"><u>Targeting type</u></a>: You can chose what type of targeting to use when finding the target. Currently supported is <i>Regular monster</i> which is the targeting used by unbrained roaches, goblins, etc.<br />
      <a name="get-natural-target-results"><u>Results</u></a>: Results from this function are stored in <b>_ReturnX</b> and <b>_ReturnY</b> which are global variables, accessible by all scripts.<br />
	  <a name="get-natural-target-no-target"><u>No target</u></a>: If no target is found the character's current position will be returned.<br />
      <a name="get-natural-target-using-in-conditions"><u>Using in conditions</u></a>: This command <b>cannot</b> be used with an <a href="#if">if statements</a>.<br />
	</li>
	<li><a name="get-entity-direction"><b>Get entity direction</b></a> - Gets the direction an entity at a given position is facing and stores the result in <b>_ReturnX</b>.<br/>
      <a name="get-entity-direction-direction-values"><u>Direction values</u></a>: NW=0, N=1, NE=2, W=3, No orientation=4, E=5, SW=6, S=7, SE=8.<br />
      <a name="get-entity-direction-guard-targets"><u>Results</u></a>: Result from this function is stored in <b>_ReturnX</b> which is a global variables, accessible by all scripts.<br />
	  <a name="get-entity-direction-no-target"><u>No target</u></a>:  If no entity is found the function returns No orientation. If player is found on the specified position, the player's direction is returned.<br />
      <a name="get-entity-direction-using-in-conditions"><u>Using in conditions</u></a>: This command <b>cannot</b> be used with an <a href="#if">if statements</a>.<br />
	</li>
</ol>

<p><a name="decision"><b>5.&nbsp;&nbsp;Decision making</b></a> - Use the
following commands to execute only a marked portion of script commands or to
continue executing script commands from a different location in the script.</p>
<ol>
  <li><a name="if"><b>If ...</b></a> - Use this command to optionally run a
      block of one or more script commands, based on a condition you specify in
      the next script command, which must be a query. If the query is
      immediately satisfied, then the script commands that follow after will be
      executed.  An <a href="#ifend"><b>If End</b></a>,
      <a href="#else"><b>Else</b></a> or <a href="#else-if"><b>Else if</b></a> command indicates the end of the optional
      code block. If the following query is not true, the script will continue
      after the following the next <a href="#else"><b>Else</b></a> or
      <a href="#ifend"><b>If End</b></a> command that marks the end of the
      optional code block.</li>
  <li><a name="if"><b>If ...</b></a>. The end of the <a href="#else"><b>Else</b></a>
      block is indicated with an <a href="#ifend"><b>If End</b></a> command.</li>
  <li><a name="else"><b>Else</b></a> - Marks the beginning of a script section
      that is executed if the query condition following the
      <a href="#if"><b>If ...</b></a> command is <u>not</u> satisfied.
      <b>Else</b> commands in conditional blocks are optional, but they must
      always follow somewhere after an <a href="#if"><b>If ...</b></a> to be
      meaningful.</li>
  <li><a name="else-if"><b>Else if</b></a> can optionally be used instead of <a href="#else"><b>Else</b></a> to avoid nesting script commands. It works exactly the same as nesting an <a href="#if"><b>If ...</b></a> <a href="#ifend"><b>If End</b></a> block inside an <a href="#else"><b>Else</b></a></li>
  <li><a name="ifend"><b>If End</b></a> - Marks the end of
      <a href="#if"><b>If ...</b></a> and <a href="#else"><b>Else</b></a> blocks.<br />
      <a name="condnotes">Notes:</a>
      <ol>
        <li>A "?" symbol displayed in front of a command in the script list
            means the command is not a recognized as a valid condition for an
            <a href="#if"><b>If ...</b></a> command.</li>
        <li><a href="#if"><b>If ...</b></a> commands may be nested, i.e., an
            inner code block may be completely contained within an outer code
            block.</li>
        <li>A "!" symbol displayed in front of a command in the script list
            means that an <a href="#if"><b>If ...</b></a> or
            <a href="#else"><b>Else</b></a> block is not properly closed with an
            <a href="#ifend"><b>If End</b></a> command at the end, or that an
            <a href="#else"><b>Else</b></a> command is placed without an
            <a href="#if"><b>If ...</b></a> coming first.</li>
        <li>See "<a href="#branchingexamples">Examples of branching code
             structures</a>" below.</li>
      </ol></li>
  <li><a name="label"><b>Label</b></a> - marks a location in the script to
      continue executing commands from (used in conjunction with
      <a href="#goto"><b>Go to</b></a> and <a href="#answer"><b>Answer option</b></a>
      commands).  Also, labels may be used to simply comment in normal language
      on what the following script commands do.</li>
  <li><a name="goto"><b>Go to</b></a> - Select a label to continue executing
      commands from.  Hint: Use "Go to" to make a loop in the script that repeats a
      sequence of commands over and over. Use a <a href="#wait"><b>Wait 0</b></a>
      command as the last statement of a loop that is to be executed once each
      turn.</li>
  <li><a name="gosub"><b>Gosub</b></a> - Similar to "Go to", it continues execution from the indicated label. Used in conjunction with "Return" for more modular scripting.</li>
  <li><a name="return"><b>Return</b></a> - Continue executing commands from the most recent "Gosub" command executed. When multiple Gosub commands are executed, then multiple Return commands will jump back to these in order from most to least recent.</li>
  <li><a name="endonexit"><b>End on room exit</b></a> - Removes the NPC for the
      rest of the current game once the player exits the room.  If the room is
      restarted before exit, then the NPC script will begin executing again from
      the beginning. Hint: use this command to have the NPC continue executing
      commands.</li>
  <li><a name="end"><b>End</b></a> - Ends the character script immediately and
      will remove the NPC for the rest of the current game once the player exits
      the room. If the room is restarted before exit, then the NPC script will
      begin executing again from the beginning. Hint: use this command to stop
      the NPC from executing any more commands.</li>
</ol>

<p><a name="usagenotes"><b>Notes about using NPC scripts</b></a></p>
<ol>
  <li><a name="lifecycle">Each</a> character script begins execution when the
      room is entered. Once a script runs to completion, the character stops
      functioning.  If the NPC is still in the room when the script ends, it
      will remain where it is until the player exits the room.  Upon reentry,
      the script will start again from the beginning.</li>
  <li>NPCs are not used to determine room completion (conquer status). That is,
      NPCs with un-<a href="#end"><b>End</b></a>ed scripts will continue to
      appear in a conquered room each time the player reenters it.</li>
  <li><a name="dontrestart">A</a> script can be made to not start again when
      the player reenters the room by placing an <a href="#end"><b>End</b></a>
      command at the end of the script or by executing an
      <a href="#endonexit"><b>End on room exit</b></a> command anywhere within
      the script.  A character can be made to run only while the room is
      unconquered by placing an <b><a href="#if">If</a>
      &lt;<a href="#waitclean">Wait for Clean Room</a>&gt;</b> check at the
      beginning of the script and <a href="#ifend"><b>If End</b></a> at the end.</li>
  <li>An NPC can be turned into a regular monster with the
      <a href="#turnintomonster"><b>Turn into monster</b></a> command.  In this
      case, it may need to be killed in order to conquer the room.</li>
</ol>

<p><a name="imperativelist"><b>Imperatives</b>
</a> - NPC/script properties that may be set with the <a href="#imperative">Imperative</a> command.</p>
  <ul>
    <li><a name="impvulnerable"><b>Vulnerable</b></a>: Makes the NPC vulnerable to
      killing. This is the default setting for most NPC graphic types.</li>
    <li><a name="impinvulnerable"><b>Invulnerable</b></a>: Makes the NPC
      invincible so it cannot be killed by stabbing or other methods of
      inflicting damage. The NPC may still be killed by falling off a platform
      or by briar growth.  Some NPC types, like Wubbas, are invulnerable by
      default.</li>
    <li><a name="impcritical"><b>Critical hero</b></a>: When set, the room will
      restart if the NPC is ever killed. Some NPC types, like Beethro and Halph,
      are marked critical heros by default.</li>
    <li><a name="imprequired"><b>Required target</b></a>: When set, the NPC must
      be killed in order to conquer the room.  This command only applies when
      the room is not otherwise clean on entrance.</li>
    <li><a name="impsafe"><b>Safe</b></a>: Forbids the NPC to step on the player
      and kill him (default).</li>
    <li><a name="impswordsafe"><b>Sword safe to player</b></a>: Sword stabs from
      this NPC won't harm the player.</li>
    <li><a name="impdeadly"><b>Deadly</b></a>: Allows the NPC to step on the
      player and kill him.  Also makes sword hits deadly to the player (default).</li>
    <li><a name="imp-friendly"><b>Friendly</b></a>: Marks the NPC as "friendly". Killing it will not break stealth, and Stalwarts and Soldiers will avoid stabbing the NPC. 
	An NPC that is set as <a href="impsafe">Safe</a> is automatically set to be friendly.</li>
    <li><a name="imp-unfriendly"><b>Unfriendly</b></a>:  Marks the NPC as "unfriendly". Killing it will break stealth, and Stalwarts and Soldiers may stab the NPC. 
	An NPC that is set as <a href="impdeadly">Deadly</a> is automatically set to be unfriendly.</li>
    <li><a name="impdie"><b>Die</b></a>: Makes the NPC die with a blood splatter.</li>
    <li><a name="impdiespecial"><b>Die special</b></a>: Makes the NPC perform a
      monster-specific death sequence, if applicable.  Currently, this command
      applies to rock golems and fegundos. Rock golem NPCs will turn into a rock
      pile when this command is invoked. Fegundos will explode and turn into a
      regular fegundo ash monster. For other monster types, this acts
      identically to "Die".</li>
    <li><a name="impendwhenkilled"><b>End when killed</b></a>: If the NPC is killed,
      mark the script as ended so it doesn't repeat when the room is reentered.</li>
    <li><a name="impdirectonlybeelining"><b>Direct-only beelining</b></a>: When
      desired diagonal movement is blocked, then don't move at all.</li>
    <li><a name="imp-normal-beelining"><u>Normal beelining</u></a>: Move diagonally when desired and possible, otherwise move axially if possible, prefering vertical movement when both horizontal and vertical movements are open.</li>
    <li><a name="imp-smart-beelining"><u>Smart beelining</u></a>: In addition to Normal beelining behavior, when a
      desired diagonal movement is blocked, choose the better of
      horizontal or vertical movement that will get closer to the destination (default).</li>
    <li><a name="imp-smart-beelining"><b>Smart beelining</b></a>: As flexible beelining, but also will move diagonally closer to the destination when a desired axial move is blocked.</li>
    <li><a name="imp-pathfinding-openonly"><b>Pathfinding (open only)</b></a>: The shortest path is calculated and taken to the destination.  Whenever the currently calculated path becomes blocked, then a new shortest path is calculated. When no open path is found, no movement is made.</li>
    <li><a name="imp-pathfinding"><b>Pathfinding</b></a>: The most intelligent movement option. The shortest path is calculated and taken to the destination. Whenever the currently calculated path becomes blocked, then a new shortest path is calculated. When no open path is found to the destination, then the path that has the fewest obstacles along the way is followed, defaulting to normal beelining whenever obstacles completely block the remaining path.</li>
    <li><a name="imp-brain-pathmap-obstacle"><b>Brain pathmap obstacle</b></a>: This NPC is perceived as an obstacle to brain pathmaps, and brained pathmaps will calculate paths around the NPC.</li>
    <li><a name="imp-not-brain-pathmap-obstacle"><b>Not brain pathmap obstacle</b></a>: This NPC is not perceived as an obstacle to brain pathmaps (default), and brained pathmaps will not calculate paths around the NPC.</li>
    <li><a name="imp-npc-pathmap-obstacle"><b>NPC pathmap obstacle</b></a>: This NPC is perceived as an obstacle to other NPCs using the Pathfinding imperative. Other NPC pathmaps will be calculated around this NPC.</li>
    <li><a name="imp-not-npc-pathmap-obstacle"><b>Not NPC pathmap obstacle</b></a>: This NPC is not perceived as an obstacle to other NPCs using the Pathfinding imperative. Other NPC pathmaps will not be calculated around this NPC.</li>
	<li><a name="imp-ghost-display"><b>Ghost display</b></a>: When invisible this character will still be drawn to the screen. It will be drawn before (underneath) visible entities.</li>
	<li><a name="imp-ghost-display-overhead"><b>Ghost display overhead</b></a>: Just like <i>Ghost display</i> above, except the NPC will be drawn over other characters and monsters.</li>
	<li><a name="imp-no-ghost-display"><b>No ghost display</b></a>: Disables any previously activated <i>Ghost display</i> on this NPC.</li>
	<li><a name="imp-invisible-inspectable"><b>Invisible inspectable</b></a>: This NPC will be included in the tile description when right-clicking on its tile even when it is invisible (Ghost Display is treated as invisible).</li>
	<li><a name="imp-invisible-not-inspectable"><b>Invisible not inspectable</b></a>: This NPC will not be included in the tile description when right-clicking on its tile when it is invisible.</li>
	<li><a name="imp-invisible-includes-move-order"><b>Invisible includes move order</b></a>: Even when invisible (Ghost Display is still invisible) this NPC will be counted for the purpose of determining movement order. Additionally, if <i>Invisible inspectable</i> imperative is set, the movement order of this character will also be visible.</li>
	<li><a name="imp-invisible-dont-include-move-order"><b>Invisible don't include move order</b></a>: Reverses the above to original behavior - this NPC when invisible will not be included when counting movement order and if it's inspectable the movement order will not be displayed when right clicking on its tile.</li>
	<li><a name="imp-not-pushable"><b>Not pushable</b></a>: Makes this NPC resistant to any kind of pushing, even with weapons which naturally allow pushing (eg. staff).</li>
	<li><a name="imp-default-pushable-behavior"><b>Default pushable behavior</b></a>: Resets the pushability of the NPC to the default behavior.</li>
	<li><a name="imp-pushable-by-body"><b>Pushable by body</b></a>: Makes the NPC pushable by the body of the player, mimics, constructs and characters with the <a href="#beh-push-monsters">Push Monsters</a> behavior. Regular, non-NPC guards, stalwarts, slayers and soldiers can't push mirrors and thus won't be able to push an NPC with this imperative. The same goes for all monsters except constructs which can push mirrors.</li>
	<li><a name="imp-pushable-by-weapon"><b>Pushable by weapon</b></a>: Makes the NPC pushable by any weapon effectively making it invulnerable to weapon attacks. It won't be able to push the NPC wielding dagger because dagger doesn't occupy a physical space. All other forms of attack still kill the NPC, including adders eating them, explosions, spike and fire traps.</li>
    <li><a name="imp-stunnable"><b>Stunnable</b></a>: Weapon pushes will stun this NPC.</li>
	<li><a name="imp-not-stunnable"><b>Not stunnable</b></a>: Weapon pushes will not stun this NPC, but it will not move on the turn it was pushed (unless it was pushed after it already moved).</li>
  </ul>

<p><a name="behaviorlist"><b>Behaviors</b>
</a> - NPC properties that may be turned on and off with the <a href="#behavior">Behavior</a> command. In most cases, the <a href="#impinvulnerable">Invulnerable</a> imperative takes precedent over damage immunity behaviors. Some NPC types will have behaviors set by default. Changing an NPC's appearance with <a href="#setappearance">Set appearance</a> will reset behaviors to that appearance's default behaviors unless the <b>Keep Behaviors</b> option is set to on.</p>
<ol>
	<li><a name ="beh-activate-token"><b>Activate Tokens</b></a>: The NPC will activate architectural tokens when it moves onto them, other than Temporal Split Points.</li>
	<li><a name ="beh-activate-plates"><b>Activate Pressure Plates</b></a>: The NPC will press pressure when it moves onto them, and will hold down pressure plates while on them.</li>
	<li><a name="beh-drop-trapdoor"><b>Drops Trapdoors</b></a>: The NPC will drop trapdoors and melt thin ice.</li>
	<li><a name="beh-drop-trapdoor-armed"><b>Drop Trapdoors When Armed</b></a>: The NPC will drop trapdoors if it is armed with a weapon, and will melt thin ice.</li>
	<li><a name="beh-push-objects"><b>Push Objects</b></a>: The NPC can push objects such as Mirrors and Powder Kegs.</li>
	<li><a name="beh-push-monsters"><b>Push Monsters</b></a>: The NPC can push monsters that can be pushed. Currently, only NPCs with <a href="#imp-pushable-by-body">Pushable by body</a> can be pushed in this manner.</li>
	<li><a name="beh-move-platform"><b>Move Platforms and Rafts</b></a>: The NPC can push platforms and rafts by moving against their sides.</li>
	<li><a name="beh-restricted-movement"><b>Restricted Movement</b></a>: The NPC can only move onto tiles it's movement type would normally allow movement onto. See <a href="#set-movement">Set movement type</a> for details.</li>
	<li><a name="beh-monster-attackable"><b>Can Be Attacked By Monsters</b></a>: Hostile monsters can move onto and kill the NPC. Monster attacks ignore the <a href="#impinvulnerable">Invulnerable</a> imperative. Additionally, this does not affect whether an Adder can eat the NPC.</li>
	<li><a name="beh-monster-target"><b>Monster Target</b></a>: Monsters other than Puffs will treat the NPC as a target. This does not affect the NPC's vulnerability to monsters.</li>
	<li><a name="beh-monster-target-if-player"><b>Monster Target When Player Is Target</b></a>: Monsters other than Puffs will treat the NPC as a target as long as the player is a monster target. Otherwise, monsters will ignore this character. This does not affect the NPC's vulnerability to monsters.</li>
	<li><a name="beh-ally-target"><b>Ally Target</b></a>: Stalwarts and Soldiers will treat the NPC as a target. However, they will avoid stabbing the NPC if it is <a href="#imp-friendly">Friendly</a>.</li>
	<li><a name="beh-puff-target"><b>Puff Target</b></a>: Puffs will treat the NPC as a target. This does not affect the NPC's vulnerability to puffs.</li>
	<li><a name="beh-sword-immune"><b>Sword Damage Immunity</b></a>: Attack from swords will not kill the NPC.</li>
	<li><a name="beh-pickaxe-immune"><b>Pickaxe Damage Immunity</b></a>: Attack from pickaxes will not kill the NPC. The NPC can still be pushed by pickaxes</li>
	<li><a name="beh-spear-immune"><b>Spear Damage Immunity</b></a>: Attack from spears will not kill the NPC. The NPC can still be pushed by spears.</li>
	<li><a name="beh-dagger-immune"><b>Dagger Damage Immunity</b></a>: Attack from daggers will not kill the NPC. This includes step attacks from dagger-wielding entities.</li>
	<li><a name="beh-caber-immune"><b>Caber Damage Immunity</b></a>: Attack from cabers will not kill the NPC. The NPC can still be pushed by cabers.</li>
	<li><a name="beh-floor-spike-immune"><b>Floor Spikes Immunity</b></a>: The NPC cannot be killed by spike traps. Flying NPCs will ignore the state of this behavior, and are always immune to spike traps.</li>
	<li><a name="beh-fire-trap-immune"><b>Fire Trap Immunity</b></a>: The NPC will not be killed due to ending the turn on an active fire trap.</li>
	<li><a name="beh-hot-tile-immune"><b>Hot Tile Immunity</b></a>: The NPC will not be killed due to staying on a hot tile for more than a turn. Flying NPCs will ignore the state of this behavior, and are always immune to hot tiles.</li>
	<li><a name="beh-explosion-immune"><b>Explosion Immunity</b></a>: The NPC cannot be killed by explosions, including ones from the Attack Tile command.</li>
	<li><a name="beh-briar-immune"><b>Briar Immunity</b></a>: Briar cannot grow onto and kill the NPC.</li>
	<li><a name="beh-adder-immune"><b>Adder Immunity</b></a>: Adders cannot eat the NPC.</li>
	<li><a name="beh-puff-immune"><b>Puff Immunity</b></a>: The NPC cannot be killed by puffs, either from Puffs moving onto them, or due to the NPC moving onto a Puff. This does not affect whether the NPC attracts Puffs.</li>
	<li><a name="beh-fatal-push-immune"><b>Push to Fall Immunity</b></a>: The NPC cannot be pushed onto pit or water tiles if this would kill them. The NPC can still be pushed into other potentially dangerous tiles, such as active fire traps.</li>
</ol>

<p><a name="functions"><b>Function primitives</b></a> - Predefined
  functions may be inserted anywhere a variable is referenced. The function will
  return a value based on the input parameters and current game context, where applicable.
  Functions are useful to apply in variable expressions.
  All inputs must either be integer values or an expression that resolves to an integer value.
  All outputs are likewise integers.
  Function names are case-insensitive.
</p>
<p><a name="abs">* <b>_abs(x)</b></a> - Returns the absolute value of x</p>
<p><a name="min">* <b>_min(x,y)</b></a> - Returns the lesser of two values</p>
<p><a name="max">* <b>_max(x,y)</b></a> - Returns the greater of two values</p>
<p><a name="orient">* <b>_orient(dx,dy)</b></a> - Returns an orientation id (0-8), given x,y directional offsets</p>
<p><a name="facing">* <b>_facing(dx,dy)</b></a> - Returns the orientation id (0-8) most directly facing in the direction of the given x,y vector</p>
<p><a name="ox">* <b>_ox(o)</b></a> - Given an orientation id (0-8), returns its x component offset (-1, 0, 1).  Given an invalid orientation value, the same value is returned.</p>
<p><a name="oy">* <b>_oy(o)</b></a> - Given an orientation id (0-8), returns its y component offset (-1, 0, 1).  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotatecw">* <b>_rotateCW(o)</b></a> - Given an orientation id (0-8), returns the id of the orientation in a clockwise direction.  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotateccw">* <b>_rotateCCW(o)</b></a> - Given an orientation id (0-8), returns the id of the orientation in a counter-clockwise direction.  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotatedist">* <b>_rotateDist(o1, o2)</b></a> - Give two orientation ids (0-8), returns the number of rotations between them. If either value is invalid, or has a value of 4, returns a value of zero.</p>
<p><a name="dist0">* <b>_dist0(x1,y1,x2,y2)</b></a> - Returns the L-infinity norm (max axial distance) between two 2-D coordinates.</p>
<p><a name="dist1">* <b>_dist1(x1,y1,x2,y2)</b></a> - Returns the L-1 norm (Manhattan distance) between two 2-D coordinates.</p>
<p><a name="dist2">* <b>_dist2(x1,y1,x2,y2)</b></a> - Returns the L-2 norm (Euclidean distance) between two 2-D coordinates.</p>
<p><a name="arrowdir">* <b>_ArrowDir(x,y)</b></a> - Returns the the orientation id (0-8) for the arrow at the room location (x,y). If no arrow is present, returns a value of 4.</p>
<p><a name="roomtile">* <b>_RoomTile(x,y,z)</b></a> - Returns the numeric id of the room tile at (x,y). Use the z parameter to select the tile layer.<br/>
Supported layer values - 0 -> O Layer, 1 -> F Layer, 2 -> T Layer <br/>
Hint: Each layer corresponds to a tab in the editor's tile selection dialog.
</p>
<p><a name="monstertype">* <b>_MonsterType(x,y)</b></a> - Returns the numeric monster type of the monster at (x,y). If no monster is present on the tile, -1 is returned.<br/>
Hint: This can be used to compare the monsters in different tiles, or for providing a value for _MyScript injection.
</p>

<p><a name="branchingexamples"><b>Examples of branching code structures:</b></a></p>
<ol>
  <li><a name="singlecodebranch">A single code branch:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;some optional commands here<br />
      <b>If End</b>
  </li>
  <li><a name="twocodebranch">Two code branches:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      <b>Else</b><br />
      &nbsp;&nbsp;&nbsp;some other commands here<br />
      <b>If End</b>
  </li>
  <li><a name="nestedbranches">Nested branches:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      &nbsp;&nbsp;&nbsp;<b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;some more commands here<br />
      &nbsp;&nbsp;&nbsp;<b>If End</b><br />
      &nbsp;&nbsp;&nbsp;some different commands here<br />
      <b>If End</b>
  </li>
</ol>

<p><a name="commandkeyexample"><b>Example of using the Special Command key</b></a></p>
  Speech Halph "Press Special Command to make me say something."<br />
Label "Loop"<br />
  Wait for event Player uses special command<br />
  Speech Happy Halph "You did it!"<br />
  Wait 0 turn(s)<br />
  Go to "Loop"<br />

<p><a name="world-map-command-ex"><b>Example of using World Map commands</b></a></p>
<p>When a player moves close to a level exit that transitions to an overworld map, use a script that defines a couple of locations on the map (level entrances) that the player can travel to in this manner:</p>
  Wait for entity Player 22,24,22,24<br />
  World Map Select 1<br />
  World Map Music 0,0<br />
  World Map Tile Icon Halph,Level state,100,100,1<br />
  World Map Tile Icon Beethro,Level state,200,200,2<br />
  End<br />
<p>This script should typically only be executed once, hence the "End" command that runs last.</p>

<p><a name="predefined-script-vars"><b>Predefined script vars</b></a></p>
<p>There are a number of predefined script vars that begin with an underscore.
You may select these in variable commands to examine or set certain game states.</p>
<ul>
	<li><b>_MyWeapon</b> - Sets the weapon wielded by the NPC.</li>
	<li>
	<b>_MyColor</b> - Additional tint applied to the character. When the value is -1 (default) no color is applied, otherwise the format is a 6-digit number RRGGBB, where RR is the value for Red tint, GG for Green and BB for Blue. Value of 50 for given color is normal, lesser than 50 will reduce the color, larger than 50 will add the color. Some examples:
	<ul>
		<li><b>505050</b> - No color change</li>
		<li><b>FFFFFF</b> - Twice as bright</li>
		<li><b>005000</b> - Red and green will be removed</li>
		<li><b>FF5050</b> - WIll be more red than before</li>
	</ul>
	</li>
	<li><b>_MyX</b> and <b>_MyY</b> - X and Y position of the NPC. Please keep in mind that the change is instanteous, if you need to modify the position in both axes use 'Teleport to' instead, otherwise you risk creating problematic situation when the NPC teleports first in one axis and then in the other.</li>
	<li><b>_MyO</b> - NPC's current <a href="#valuesorientation">orientation</a>.</li>
	<li><b>_MyName</b> - Name of this NPC. Used for right-click inspecting and for speech log.</li>
	<li><b>_MyScript*</b> - Variables used to inject dynamic values into other scripting commands. <a href="#myscript-injection">See this section</a> for explanation on how to use them.</li>
	<li><b>_X</b> and <b>_Y</b> - X and Y position of the Player. Can cause the same potential problems as <b>_MyX</b> and <b>_MyY</b>, so use 'Teleport player to' wheen you need to teleport along two axes.</li>
	<li><b>_O</b> - Player's current <a href="#valuesorientation">orientation</a>.</li>
	<li><b>_RoomImageX</b> and <b>_RoomImageY</b> - Offset of the custom room image in tiles.</li>
	<li><b>_OverheadImageX</b> and <b>_OverheadImageY</b> - Offset of the custom overhead image in tiles.</li>
	<li><b>_ThreatClock</b> - <a href="#threatclockdisplay">See this section</a>.</li>
	<li><b>_LevelName</b> - <u>Read only!</u> Gets the name of the level.</li>
	<li><b>_RoomX</b> and <b>_RoomY</b> - <u>Read only!</u> Gets the position of the current room in the level.</li>
	<li><b>_PlayerLight</b> - <a href="#playerlightvars">See this section</a></li>
	<li><b>_PlayerLightType</b> - <a href="#playerlightvars">See this section</a></li>
	<li><b>_ReturnX</b> and <b>_ReturnY</b> - Used by other commands to return values for later use, eg. Get Natural Target. Otherwise can be used for temporary storing information.</li>
	
</ul>

<p><a name="playerlightvars"><b>Player light vars</b></a></p>
"<b>_PlayerLightType</b>" affects the player's light in dark rooms.
Set it to a value &lt;0 to turn off, 0 to turn on, and from 1-100 to use a flashlight beam.  A higher value creates a more focused beam.<br />
Set "<b>_PlayerLight</b>" to a value between 0 (default) through 128 to alter the player's light intensity and color, as follows:<br />
16*(INTENSITY-1) + LIGHT_COLOR<br />
where INTENSITY is from 1-8 and LIGHT_COLOR is from 1-16.<br />
Variables prefixed with "_My" are connected to the state of the NPC, the "_*ImageX/Y" vars are tied to the defined origin for your room's custom images, and so forth.<br/>
<br/>

<p><a name="threatclockdisplay"><b>Threat clock display modes</b></a></p>
  You may set the predefined "_ThreatClock" script variable to modify dynamically how the threat clock is displayed during play. The supported values are:<br />
0: default<br />
1: hide<br />
2: always show<br />
3: backwards time<br />
100-129: display specific time (0-29)<br />
200-229: display specific half-tick (0-29)<br />
<br/>

<p><a name="playerinputvars"><b>List of player command input variables</b></a></p>
  Predefined variable names may be provided in texts to output the player's current key binding for the respective command as text. To do this, provide a variable name of the form "$_CMD_&lt;key&gt;$", where &lt;key&gt; is one of the following:
<ul>
<li>MoveNorthwest</li>
<li>MoveNorth</li>
<li>MoveNortheast</li>
<li>MoveWest</li>
<li>Wait</li>
<li>MoveEast</li>
<li>MoveSouthwest</li>
<li>MoveSouth</li>
<li>MoveSoutheast</li>
<li>SwingClockwise</li>
<li>SwingCounterclockwise</li>
<li>Restart</li>
<li>Undo</li>
<li>Battle</li>
<li>UseCommand</li>
<li>CloneSwitch</li>
</ul>

<p><a name="image-overlay-commands"><b>Image overlay commands</b></a></p>
  In addition to selecting an image for display with the "Image overlay" command, you must provide a simple set of commands to define how the image will be displayed in-game.  The list of supported (case-insensitive) commands for use in an Image Overlay script is as follows:<br />
<br />
<b>AddX (pixels)</b> -- shifts the image's X coordinate. Positive values shift to the right, negative values shift to the left.<br />
<b>AddY (pixels)</b> -- shifts the image's Y coordinate. Positive values shift downwards, negative values shift upwards.<br />
<b>CancelAll</b> -- remove all currently displaying image overlay effects. This command is typically run singly.<br />
<b>CancelGroup (group #)</b> -- remove image overlay effects in the specified display group (0 or greater)<br />
<b>CancelLayer (layer #)</b> -- remove image overlay effects on the specified display layer (0 through 3)<br />
<b>Center</b> -- center the image within the room area<br />
<b>Display (ms)</b> -- display the image in its current form for the specified duration<br />
<b>DisplayRect (x) (y) (w) (h)</b> -- show this region of the source image<br />
<b>DisplayRectModify (delta x) (delta y) (delta w) (delta h)</b> -- modifies the display region for the source image<br />
<b>DisplaySize (w) (h)</b> -- show this amount of the source image, in pixels<br />
<b>DisplayTurns (# turns)</b> -- display the image in its current form for the indicated number of game turns<br />
<b>(p)FadeToAlpha (alpha) (ms)</b> -- transition the image from its current alpha value to the indicated value over the specified time interval<br />
<b>Group (group #)</b> -- assign the effect to the given display group (0 or greater). Overlays without a Group command are assigned to Group #0. Only the first instance of this command in a script is executed.<br />
<b>(p)Grow (percent of original) (ms)</b> -- scale the image by the indicated amount over the specified time interval<br />
<b>(p)Jitter (pixels) (ms)</b> -- randomly shake the image off-center up to the indicated range for the specified time interval<br />
<b>Layer (layer)</b> -- place the effect on the indicated display layer (0 through 3, generally corresponding to the menu tabs used for placing game elements in the room editor). Only the first instance of this command in a script is executed.<br />
<b>Loop (times)</b> -- loop through the image command list this many times (-1 = infinite)<br />
<b>(p)Move (x pixels) (y pixels) (ms)</b> -- translate the image's position by the indicated number of pixels over the indicated time interval<br />
<b>(p)MoveTo (x pixel) (y pixel) (ms)</b> -- move the image from its current position to the indicated screen location over the course of the indicated time interval<br />
<b>(p)Rotate (degrees) (ms)</b> -- rotate the image the indicated amount over the specified time interval<br />
<b>Scale (percent of original)</b> -- scale the image to the indicated amount<br />
<b>SetAlpha (0-255)</b> -- set the image's alpha transparency to the indicated value<br />
<b>SetAngle (degrees)</b> -- set the image's angle of rotation<br />
<b>SetX (pixel)</b> -- set the image's X coordinate<br />
<b>SetY (pixel)</b> -- set the image's Y coordinate<br />
<b>SrcXY (x) (y)</b> - show the source image starting from the indicated pixel position<br />
<br />
As an example, you can make an image start invisible, fade in, display for a couple seconds, then fade out by providing the following command sequence:<br />
<br />
setalpha 0 fadetoalpha 255 1000 display 2000 fadetoalpha 0 800<br />
<br />
The text supports variable interpolation, so you can have parameters like "$.ImageX$" in the text. Any part of the command text may be inserted in this fashion.<br />
Certain commands with time duration, marked above, may be optionally prefixed with the letter "p".  This indicates that the command will not run to completion before any subsequent commands are executed, but rather will run in parallel with the next command. Multiple parallel commands may be executed concurrently.<br />

<p><a name="myscript-injection"><b>_MyScript variable injections</b></a></p>

Many commands in DROD Script can accept dynamic values for certain options by taking values from any of the _MyScript variables. When a _MyScript variable is equal to -9999 it indicates its value should not be used - anything else and commands will take their values, overriding whatever you input in the command itself.<br/>
<br/>
Below is a table of all the ways this can be used:<br/>
<br/>
<table>
<tr>
<td width="180">Command</td>
<td width="95">X</td>
<td width="95">Y</td>
<td width="95">W</td>
<td width="95">H</td>
<td width="95">F</td>
</tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>Activate item</b></td>        <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Amb. Sound at</b></td>        <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Appear at</b></td>            <td>Target X</td>     <td> Target Y</td>     <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Attack Tile</b></td>          <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td>Attack type</td></tr>
<tr><td><b>Push Tile</b></td>          <td>Target X</td>     <td>Target Y</td>        <td>Direction</td>             <td></td>             <td></td></tr>
<tr><td><b>Build</b></td>                <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Tile type</td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>Build marker</b></td>         <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Tile type</td></tr>
<tr><td><b>Cut scene</b></td>            <td>Ms per frame</td> <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Destroy trapdoor</b></td>     <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td></td></tr>
<tr><td><b>Display filter</b></td>       <td>Filter</td>       <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Face Direction</b></td>       <td>Orientation</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>Face Towards</b></td>         <td>Target X</td>     <td>Target Y</td>      <td>Single Step</td>  <td></td>             <td>Entity bitmap</td></tr>
<tr><td><b>Flash mess.</b></td>          <td>Red, 0-255</td>   <td>Green, 0-255</td>  <td>Blue, 0-255</td> <td>Use color?</td>   <td></td></tr>
<tr><td><b>Game effect</b></td>          <td>Target X</td>     <td>Target Y</td>      <td>Orientation</td>  <td>Game effect</td>  <td>Play sound</td></tr>
<tr><td><b>Generate entity</b></td>      <td>Target X</td>     <td>Target Y</td>      <td>Orientation</td>  <td>Entity</td>       <td></td></tr>
<tr><td><b>Get entity dir.</b></td>      <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>Get natural target</b></td>   <td>Target type</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Goto lev. entrance</b></td>   <td></td>             <td>Skip e. screen</td><td></td>             <td></td>             <td></td></tr>
<tr><td><b>Move</b></td>                 <td>X Move</td>       <td>Y Move</td>        <td>Allow Turn.</td>  <td>Single Step</td>  <td></td></tr>
<tr><td><b>Move to</b></td>              <td>Target X</td>     <td>Target Y</td>      <td>Allow Turn.</td>  <td>Single Step</td>  <td>Entity bitmap</td></tr>
<tr><td><b>Play Video</b></td>           <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>Set player weapon</b></td>    <td>Weapon</td>       <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Teleport Player</b></td>      <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Teleport To</b></td>          <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td></td></tr>
<tr><td><b>Wait</b></td>                 <td>Wait turns</td>   <td>Y</td>             <td> </td>            <td> </td>            <td> </td></tr>
<tr><td><b>W. entity</b></td>      <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Entity bitmap</td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>W. entity type</b></td>   <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Entity</td></tr>
<tr><td><b>W. door</b></td>        <td>X</td>            <td>Y</td>             <td></td>             <td></td>             <td></td></tr>
<tr><td><b>W. item</b></td>        <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Tile type</td></tr>
<tr><td><b>W. no build mark.</b></td>  <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td></td></tr>
<tr><td><b>W. open move</b></td>         <td>Orientation</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>W. player to face</b></td>    <td>Orientation</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>W. player to input</b></td>   <td>Command</td>      <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>W. player to move</b></td>    <td>Orientation</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td><b>W. remains</b></td>     <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Remains</td></tr>
<tr><td><b>W. turn</b></td>        <td>Turn number</td>  <td></td>              <td></td>             <td></td>             <td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td><b>W. weapon</b></td>      <td>Target X</td>     <td>Target Y</td>      <td></td>             <td></td>             <td>Weapon</td></tr>
<tr><td><b>W. while entity</b></td>      <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Entity bitmap</td></tr>
<tr><td><b>W. while ent. type</b></td>   <td>Rect X</td>       <td>Rect Y</td>        <td>Rect Width</td>   <td>Rect Height</td>  <td>Entity</td></tr>
<tr><td><b>W.Map Tile Icon</b></td>      <td>Target X</td>     <td>Target Y</td>      <td>Entrance</td>     <td>Entity</td>       <td>Map display</td></tr>
<tr><td><b>W.Map Image Icon</b></td>     <td>Target X</td>     <td>Target Y</td>      <td>Entrance</td>     <td>Image</td>        <td>Map display</td></tr>
</table>
<br />
<br />

<b>Entity bitmap</b><br />
This is a bit map value, meaning it can contain multiple values created by just adding them.<br/>
<b>1 (0x001)</b> - Player<br/>
<b>2 (0x002)</b> - Halph<br/>
<b>4 (0x004)</b> - Monster<br/>
<b>8 (0x008)</b> - NPC<br/>
<b>16 (0x010)</b> - Double<br/>
<b>32 (0x020)</b> - Self<br/>
<b>64 (0x040)</b> - Slayer<br/>
<b>128 (0x080)</b> - Beethro<br/>
<b>256 (0x100)</b> - Stalwart<br/>
<br/>

<b>Attack type</b>:<br />
<b>0</b> - Stab<br/>
<b>1</b> - Explode<br/>
<b>2</b> - Damage<br/>
<b>3</b> - Kill<br/>
<br/>

<b>Remains</b><br />
<b>15</b> - Rock golem<br/>
<b>26</b> - Fegundo<br/>
<b>40</b> - Construct<br/>
<br/>

<b>Weapon</b><br />
<b>-2</b> - Off<br/>
<b>-1</b> - On<br/>
<b>0</b> - Sword<br/>
<b>1</b> - Pickaxe<br/>
<b>2</b> - Spear<br/>
<b>3</b> - Staff<br/>
<b>4</b> - Dagger<br/>
<b>5</b> - Caber<br/>
<br />

<b>Game effect</b><br />
<b>0</b> - Blood splatter<br/>
<b>1</b> - Mud splatter<br/>
<b>2</b> - Tar splatter<br/>
<b>3</b> - Gel splatter<br/>
<b>4</b> - Seep splatter<br/>
<b>5</b> - Golem splatter<br/>
<b>6</b> - Slayer splatter<br/>
<b>7</b> - Debris<br/>
<b>8</b> - Sparks<br/>
<b>9</b> - Explosion<br/>
<b>10</b> - Splash<br/>
<b>11</b> - Steam<br/>
<b>12</b> - Swirl<br/>
<b>13</b> - Vermin<br/>
<b>14</b> - Bolt<br/>
<b>15</b> - Jitter<br/>
<b>16</b> - Floor spikes<br/>
<b>17</b> - Puff explosion<br/>
<b>18</b> - Fire trap<br/>
<b>19</b> - Ice melting<br/>
<b>20</b> - Puff merged into fluff<br/>
<br />

<p><a name="valuesfilters"><b>Filter</b></a></p>
<b>0</b> - Normal<br/>
<b>1</b> - Black and White<br/>
<b>2</b> - Sepia<br/>
<b>3</b> - Negative<br/>
<br/>

<p><a name="valuesmapdisplay"><b>Map display</b></a></p>
<b>0</b> - Off<br />
<b>1</b> - On<br />
<b>2</b> - Level state<br />
<b>4</b> - Locked<br />
<b>8</b> - Disabled<br />
<b>16</b> - Image only<br />
<br />

<p><a name="valuestargettype"><b>Target type</b></a></p>
<b>0</b> - Regular Monster<br />
<br />

<b>Tile type</b><br />
ID of the tile. Please refer to the source code DRODLib\TileConstants.h for a list of all tiles and their IDs.<br />
<br />

<b>Entity</b><br />
ID of the entity. Please refer to the source code DRODLib\MonsterType.h for a list of all entities and their IDs.<br />
You can also use IDs of custom entities, visible above the list of custom entities on the "Character Management" dialog<br/>
<br />

<p><a name="valuesorientation"><b>Orientation values:</b></a></p>
<b>0</b> - North-West<br />
<b>1</b> - North<br />
<b>2</b> - North-East<br />
<b>3</b> - West<br />
<b>4</b> - No Orientation<br />
<b>5</b> - East<br />
<b>6</b> - South-West<br />
<b>7</b> - South<br />
<b>8</b> - South-East<br />
<b>9</b> - Clockwise<br />
<b>10</b> - Counter clockwise<br />
<br />
<b>Command values:</b><br />
<b>1</b> - North<br />
<b>2</b> - North-East<br />
<b>3</b> - West<br />
<b>5</b> - East<br />
<b>6</b> - South-West<br />
<b>7</b> - South<br />
<b>8</b> - South-East<br />
<b>9</b> - Rotate Clockwise<br />
<b>10</b> - Rotate Counter clockwise<br />
<b>11</b> - North-West<br />
<b>12</b> - Wait<br />
<b>23</b> - Special command<br />

<hr />
<a href="character.html">Character Scripting</a><br />
<a href="editroom.html">Room Editor</a><br />
<a href="editselect.html">Level Editor</a><br />
<a href="contents.html">Contents</a><br />
</body>
</html>
