<html>
<head>
  <title>Help for DROD RPG</title>
</head>
<body bgcolor="#FFFFFF">
<img src="images/drodlogo.jpg" />
<hr />
<h3><u>Character Script Commands</u></h3>
<p>When the player enters the room, NPCs start performing the custom behavior
you designate.  The scripting system is quite flexible and allows you to
implement a wide variety of behaviors.
There are five general classes of script commands, as follows:</p>
<ol>
  <li><a href="#placement">Placement</a></li>
  <li><a href="#condition">Condition</a></li>
  <li><a href="#interaction">Interaction</a></li>
  <li><a href="#queries">Queries</a></li>
  <li><a href="#decision">Decision making</a></li>
  <li><a href="#lighting">Lighting</a></li>
</ol>
<p>
<a href="#usagenotes">Notes about using NPC scripts</a><br />
<a href="#imperativelist">Imperatives</a><br />
<a href="#behaviorlist">Behaviors</a><br />
<a href="#predefinedvars">Predefined vars</a><br />
<a href="#branchingexamples">Examples of branching code structures</a><br />
<a href="#multichoiceexample">Example of a multiple choice question</a><br />
<a href="#newmonsters">How to make a new monster type</a><br />
<a href="#character-on-tarstuff">Character on tarstuff</a><br />
<a href="#customequipment">How to make custom equipment</a><br />
<a href="#image-overlay-commands">Image Overlay commands</a>
</p>
<hr />
<p><a name="placement"><b>1.&nbsp;&nbsp;Placement</b></a> - Change the NPC's location.</p>
<ol>
  <li><a name="appear"><b>Appear</b></a> - If not visible, the NPC will appear
      at the current square (i.e. it enters the room).  This command does
      nothing if the NPC is already visible. If a monster or the player occupies
      the square it is appearing in, then the NPC will wait until the square is
      vacant to appear.</li>
  <li><a name="appearat"><b>Appear at</b></a> - Use this to have an invisible
      NPC enter the room at a designated square different from the one where the
      NPC is current located. After selecting this command, the room will
      temporarily appear.  Click on a square to select where the NPC will enter
      the room. This command does nothing if the NPC is already visible.  If a
      monster or the player occupies the square the NPC is to appear in, it will
      wait until the square becomes vacant to appear.</li>
  <li><a name="disappear"><b>Disappear</b></a> - Removes the NPC from the room,
      making him invisible. Use this to show an NPC leaving the room. Script
      commands continue to play while the character is invisible but the NPC
      will not physically interact with any room elements unless it Appears
      again.</li>
  <li><a name="moveto"><b>Move to</b></a> - The NPC will move to the indicated
      square (selected by clicking on a room square, as above).  Optionally, one
      of the entity types listed in the adjacent list box may be selected as who
      the NPC should follow. Hold &lt;Ctrl&gt; while clicking to select and
      unselect multiple selections. Each turn, the NPC will attempt to move one
      square closer to its destination. It moves roughly in a straight line and
      won't move on a given turn if something is in its way.
      <a name="forbidturning">Enable</a> "Forbid turning" if you don't want the
      monster turning to face the direction it is moving each step. Hint: If you
      want the NPC to move in a more complex fashion, such as following a
      twisting corridor, this can be accomplished with a sequence of <b>Move
      to</b> commands, one to navigate each twist in the corridor.  This command
      finishes when the NPC arrives at the destination square.  If the NPC is
	  not visible (i.e. not in the room), movement to the destination tile is
	  immediate.
      <a name="singlestep">Enable</a> "Single step" to have the NPC only attempt
      to make a single step toward the indicated destination before continuing
      to the next script command.  If no move can be made, the next script
      command is executed immediately.</li>
  <li><a name="move"><b>Move</b></a> - Similar to <a href="#moveto"><b>Move
      to</b></a>, except a relative number of tiles to move from the NPC's
      current location is specified.  Positive numbers indicate movement south
      and east, and negative numbers are for moving north and west.
	  When a cut scene is executing and the player's role is set to None,
	  an NPC executing a Move command that would cause the NPC to exit the room
	  causes the game to exit the room in that direction as if the player
	  had exited it.  If the NPC is
	  not visible (i.e. not in the room), movement to the destination tile is
	  immediate.</li>
  <li><a name="facedirection"><b>Face direction</b></a> - Initially, the NPC
      faces the direction it is oriented when placed in the room.  Use this
      command to turn the NPC in a different direction without moving (takes 1
      turn).</li>
</ol>

<p><a name="condition"><b>2.&nbsp;&nbsp;Condition</b></a> - How the NPC
functions.</p>
<ol>
  <li><a name="setappearance"><b>Set appearance</b></a> - Changes the NPC's
      "Graphic" and default properties to the specified entity type.</li>
  <li><a name="setmovement"><b>Set Movement Type</b></a> - Changes which tiles the NPC can move on. The options are:
  <ol>
	<li><b>Ground</b> - Normal movement behavior. The NPC cannot cross tiles that block normal movement.</li>
	<li><b>Water</b> - The NPC can move over water tiles in additional to normal floor tiles. Additionally, the NPC will not drown if dropped into water.</li>
	<li><b>Wall</b> - The NPC can move through wall and doors tiles in additional to crossing normal floor tiles.</li>
	<li><b>Air</b> - The NPC can move over all non-wall and non-door tiles. Additionally, it is not effect by damaging tiles, and cannot be killed by being dropped into water or into pits.</li>
  </ol>
  </li>
  <li><a name="turnintomonster"><b>Turn into monster</b></a> - Turns the NPC
      into a regular monster of the type indicated by its graphic.  This ends
      script execution immediately and the NPC is permanently replaced by a
	  regular monster.</li>
  <li><a name="imperative"><b>Imperative</b></a> - Sets a special status
      condition on the NPC (see <a href="#imperativelist">Imperatives</a>).
	  Compatible imperatives may be combined.</li>
  <li><a name="behavior"><b>Behavior</b></a> - Enables a behavior
      pattern for the NPC that is executed following script commands each
	  turn.  Also used to define certain attributes of the NPC's abilities
	  (see <a href="#behaviorlist">Behaviors</a>).  Compatible behaviors
	  may be combined.</li>
</ol>

<p><a name="interaction"><b>3.&nbsp;&nbsp;Interaction</b></a> - How the NPC
interacts with its environment.</p>
<ol>
  <li><a name="activateat"><b>Activate item at</b></a> - Activates the item at
      the room square you select. Items that can be activated are: orbs,
      pressure plates, lights and wall lights. Nothing will happen this turn if
      no relevant item is at the indicated square. Hint: Move the character next
      to orbs before striking them for more intuitive behavior.  If no one is
      next to the orb when struck, it will appear that Beethro is using his
      portable orb.</li>
  <li><a name="attack-tile"><b>Attack tile</b></a> - Damages the player or monster
      at the room square you select, with the specified amount of ATK power. The
      command can be configured to ignore the target's DEF value.</li>
  <li><a name="speech"><b>Speech</b></a> - Causes someone in the room to say
      something.<br />
      <a name="dialogtext"><u>Dialog text</u></a>: Type the words that are said.
      This may be left blank in order to only play a sound effect.<br />
      <a name="speaker"><u>Speaker</u></a>: who says the words. The text appears
      next to the person's figure in the room and their face appears on screen
      while they are speaking.  Use "Custom" to have the NPC "throw its voice"
      to a different square in the room.  If a monster or character is located
      at the indicated square when this command is executed, it will appear as
      if this monster or character is speaking. If speaker is set to "None", or
      the person indicated is not present in the room, then the words will
      appear next to the NPC.<br />
      <a name="mood"><u>Mood</u></a>: the face displays the indicated mood.
	  Only supports Beethro's facial expressions.<br />
      <a name="speechdelay"><u>Speech delay</u></a>: How long, in milliseconds,
      the speech lasts for.  If placing multiple lines of speech in sequence,
      this determines how much time passes until the next line of speech (and
      corresponding speaker) is displayed.  Set this value to zero to have the
      game engine calculate how long to wait based on the length of the speech
      text.<br />
      <a name="addsound"><u>Add sound</u></a>: A sound file (Wave or Ogg Vorbis
      format) on disk can be optionally attached to the speech.  If a sound is
      specified, it will play along with the text and the next speech command
      will be played when the sound completes. Use a non-zero speech delay to
      force when the next line of speech will play regardless of how long the
      attached sound file plays.<br />
      <a name="exportspeech"><u>Exporting speech text</u></a>: A hold's entire
      speech script can be exported to an HTML file on disk when exporting the
      hold by adding the line "ExportSpeech=1" to the "[Startup]" section of
      Data/drod.ini.
  </li>
  <li><a name="flushspeech"><b>Flush Speech (on/off)</b></a> - Tells the game to
      immediately process any previously queued speech that hasn't had time to
      play yet.  If "On" is selected, these texts will appear immediately
      onscreen.  If "Off" is selected, then text that hasn't played yet won't
      show at all. Hint: This command is used for dramatic effect, to ensure
      speech queued after this command will be immediately spoken, as intended.
      This command is not needed if it doesn't matter at what point in play
      speech texts are delivered.</li>
  <li><a name="ambient"><b>Ambient sound</b></a> - Plays a custom sound effect,
      imported from a sound file on disk.  Select "Loop Off" to play the sound
      once, and "Loop On" to play the sound repeatedly.  Selecting no sound file
      in conjunction with this command will silence any ambient sounds playing
      when the command is executed.</li>
  <li><a name="ambientat"><b>Ambient sound at</b></a> - Plays a custom sound
      effect, imported from a sound file on disk, from the room location you
      specify.  The sound will play from the direction the sound is coming to
      the player in the room and will be quieter the further the player is away
      from that room tile.  Selecting no sound file in conjunction with this
      command will silence any ambient sounds currently playing at the room
      location you specify.</li>
  <li><a name="buildmarker"><b>Build</b></a> - Build the specified item
      in the marked room region.</li>
  <li><a name="gotoentrance"><b>Go to level entrance</b></a> - Sends the player
      immediately to any level entrance defined in the hold, or ends the hold.
      "<u>Return to Prior Location</u>" will return the player to the last level exit
      point taken, either via stairs or script.
      Using it again consecutively will return to the location of original use.
      </li>
  <li><a name="gotoworldmap"><b>Go to world map</b></a> - Sends the player
     immediately to any world map defined in the hold.
     </li>
  <li><a name="playvideo"><b>Play video</b></a> - Plays a video file, imported
      from a video file on disk, at the specified screen coordinates.  Sound
      tracks in video files are not supported, but sounds and music may be
      played concurrently with the proper script commands.
      <a name="supportedvideo">Currently</a>, only Ogg Theora video format is
      supported.</li>
  <li><a name="setmusic"><b>Set music</b></a> - Set any of the available music
      themes to play. Additionally, custom music, imported from a music file on
      disk, may be played. Only Ogg Vorbis and Wave formats are supported.
      Custom music can be set to continue playing across rooms by executing this
      command on room entrance.</li>
  <li><a name="role"><b>Player role</b></a> - Indefinitely sets the player to
      play the role you indicate. In these roles, properties that apply to that
      entity type generally hold.</li>
  <li><a name="generateentity"><b>Generate entity</b></a> - Creates a new
      entity of the specified type at room location (x,y) and the indicated
	  orientation once that room tile is vacant.  Custom NPCs with a default
	  script defined may be created where an entity already occupies the room tile,
	  but begins as not visible.
	  NPCs will begin executing their default script when created.</li>
  <li><a name="cutscene"><b>Cut scene</b></a> - When set, room turns will
      proceed automatically at the rate you specify without player intervention.
      Invoke this command with a rate of "0" to end the cut scene and return
      movement control to the player. Hint: This command is used for dramatic
      effect, to have NPCs do things, such as move around the room, without
      requiring the player to take turns to allow the NPCs to likewise move.
      If on a given turn no NPCs are executing, the cut scene playing will
      automatically terminate, restoring control to the player.</li>
  <li><a name="answer"><b>Answer option</b></a> - Provides a multiple choice
      option for a <a href="#question"><b>Question</b></a> command (see below).
      A label from the list of defined <a href="#label"><b>Label</b></a>
      commands in the script must be selected as the point from where the script
      will continue execution if the user selects this choice.
      Up to nine answer options are supported for a given Question.  Any
      additional options are ignored.</li>
  <li>
      <a name="setvar"><b>Set var</b></a> - In addition to
      <a href="#predefinedvars">predefined variables</a>,
      each hold you create contains a set
      of zero or more variables, named by you.  Use these variables to track
      persistent game state information across rooms during play. To add a variable
      to a hold, type its name into the uppermost text box and click "Add".<br />
      <u>Syntax</u>: Variable names must begin with a letter or hash (#) and not contain any punctuation
      except underscore ('_').<br />
      <u>Arrays</u>: Starting a variable name with a hash (#) configures it as an array variable. See <a href="scriptarray.html">Script arrays</a> for more information.<br />
      To permanently remove a hold variable, select it from the list box on the
      left and click "Remove".  Note that this removes the variable completely
      from the hold and all NPC scripts that use it, not just from this
      particular script.<br />
      <u>Modifying variables</u>: <a name="varops">Select</a> a hold variable from the list, choose an
      operation and a value. Variables may either store an integer or text. If
      the operation you specify is "Assign text" or "Add text", the variable you
      select will be set to store the text you provide. You may also reference
      other variables to insert into the given text.  For operations dealing
      with numbers, if you provide the name of another variable, its value will
      be used (invalid names will be considered a value of 0). Otherwise, the
      number you provide is used. Use the text box on top to specify the text
      being assigned or added to the variable. For other operations, use the
      text box on the right to input a number or variable name. The variable
      will store a number.<br />
      <a name="varsintext"><u>Using vars in text</u></a>:
      In variable text assignments,
      <a href="#autosave">Autosave</a>, <a href="#speech">Speech</a>, <a href="#question">Questions</a>
      (see below), level entrance texts, and scroll text,
      type "$&lt;var name&gt;$" to insert the
      current value of the variable you name at this point in the text.
      Type "$\n$" to skip to the next line of text.<br />
      <a name="varref"><u>Comprehensive variable reference list</u></a>:
      In the <a href="editroom.html">Room Editor Screen</a>, press F2 to output
      a comprehensive list of hold variables to the clipboard (use the paste
      option of your favorite text editor to view this text). This list shows
      all rooms and NPC (x,y) locations where the variable is referenced in a
      script throughout the hold. A number after the (x,y) location of the
      script indicates how many times the variable is referenced in that script.<br />
      <a name="varmonitor"><u>Monitoring variables during play</u></a>:
      Press Ctrl-F7 while playing to turn on and off the variable monitor.
      Whenever a script changes a hold variable, you will be notified onscreen.
      This only works while playtesting, playing a hold you authored, or playing
      a CaravelNet hold in beta.
  </li>
  <li><a name="setvarat"><b>Set var at</b></a> - Allows the <a href="#setvar">Set var</a> command to be invoked with an NPC on another tile. All assignment and parsing will occur as if the target NPC called the Set var command. Thus, its local variables will be used, allowing them to be written or read remotely. This command can also be used an <a href="#if">If</a> condition. The condition is satisfied if the command successfully invokes a variable assignment on an NPC in the target square. Hint: Use this for scripts that rely on the result of a remote variable assignment.
  </li>
  <li><a name="resetoverrides"><b>Reset _MyScript variables</b></a> - Sets the value of all <a href="#paramoverride">_MyScript variables</a> to -9999, so they no longer override command values.</li>
  <li><a name="setmonstervar"><b>Set monster var</b></a> - Modify a
	  stat value of a monster at a specific room location.</li>
  <li><a name="eachattack"><b>Each attack</b></a> - Each time the NPC attacks,
      jump the script to the indicated <a href="#label">Label</a>.</li>
  <li><a name="eachdefend"><b>Each defend</b></a> - Each time the NPC is hit,
      jump the script to the indicated <a href="#label">Label</a>.</li>
  <li><a name="eachuse"><b>Each use</b></a> - (Custom equipment scripts only)
      Each time this equipment is activated by the player,
      jump the script to the indicated <a href="#label">Label</a>.</li>
  <li><a name="eachvictory"><b>Each victory</b></a> - 
      Each time an enemy is defeated,
      jump the script to the indicated <a href="#label">Label</a>.</li>
  <li><a name="equipment"><b>Equipment</b></a> - Modifies the player's indicated
      equipment slot.  <u>Trade</u>: set the specified custom NPC as a custom
	  item.  Any equipment the player is carrying in that slot is dropped in
	  the room, if this action will not destroy an incompatible item at the
	  player's current location.  The custom equipment begins functioning as a
	  <a href="#makescriptglobal">global script</a> until the player
	  acquires a different item.  <u>Destroy</u>: Removes any item from the
	  indicated equipment slot.  <u>Sell</u>: Gives the player the monetary
	  value of the indicated equipment and destroys it.  Non-custom equipment
	  has no sell value.  <u>Disable</u>: Indefinitely remove the use of the
	  indicated equipment type.  <u>Enable</u>: Reenable a disabled equipment type.
	  Activating a custom inventory item will execute its scripted "EachUse"
	  code segment, if defined.
	  When the "Command" type is selected, it initiates a unique global default
	  script that runs during play.
	  The player may invoke this command script using the "Special" command,
	  which executes this scripts "EachUse" block, if defined.
	  Hint: use this to enable special any-time events like warping to an
	  inventory room. Like with other items, it cannot be invoked when the
	  player is not in the room, questions are needing to be answered, or
	  combat or a cut scene is playing out.
	  Selecting this type again will replace any previous command script.
	  </li>
  <li><a name="score"><b>Score checkpoint</b></a> - Marks a score point where
      the player's score will be displayed onscreen.
	  The name you provide for this checkpoint is used on the CaravelNet score
	  boards if you publish your hold.  CaravelNet players will have their game
	  stats and score submitted to the CaravelNet high score list for this
	  checkpoint when this command executes.</li>
  <li><a name="addroomtomap"><b>Add room to map</b></a> - Marks a room in the
      current level on the player's map.  If "Full room reveal" is set,
	  then it will show the room on the minimap as if the player has already
	  explored it.  If the indicated room has already been explored
	  by the player, this command does nothing.</li>
  <li><a name="set-map-icon"><b>Set map icon</b></a> - Adds an icon for the selected
      room on the player's map. Icons can be added to unrevealed rooms but are only displayed
      on rooms that have been revealed to the player. Setting the icon to "none"
      will remove any icon from that room. In addition to normal display, icons can be
      shown in grayscale, negative color, and sepia.</li>
  <li><a name="autosave"><b>Autosave</b></a> - Automatically saves the player's
      game in an "Autosave" slot under the name you provide.
	  Whenever this command is executed, any previous
	  autosave slot with the same name will be overwritten.
	  Hint: You might consider
	  including this command at importing game points, such as whenever a new
	  level is entered.</li>
  <li><a name="gameeffect"><b>Game effect</b></a> - Display a visual effect
	  at a specified room location.  Particle effects may have a direction
	  given them.  Some effects may play an optional accompanying sound effect.</li>
  <li><a name="image-overlay"><b>Image overlay</b></a> - Input a <a href="#image-overlay-commands">custom set of commands</a> for displaying a custom image effect in the game room.</li>
  <li><a name="world-map-select"><b>World Map Select</b></a> - Select an overworld map for subsequent World Map commands to be performed with reference to. Without this command, the other World Map commands will do nothing.</li>
  <li><a name="world-map-music"><b>World Map Music</b></a> -
Sets the music that plays on the previously selected map. This only need be executed once during a hold playthrough. Any subsequent executions will override the previous setting.</li>
  <li><a name="world-map-tile-icon"><b>World Map Tile Icon</b></a> - Places an icon on the previously selected map. You specify the position the icon appears on the map, its state, and if active, what level entrance or map it leads to when the player clicks on it from this map screen. Icons persist on the specified map from that moment for the entire playthrough. Placing an icon at the same position as another will override the first. Using icon type "Off" will remove an icon from the map. You can select a custom NPC with a looping animation speed in order to display an animated graphic on the map.</li>
  <li><a name="world-map-image-icon"><b>World Map Image Icon</b></a> - Places an image on the previously selected map. Works in other respects as the "World Map Tile Icon" command.</li>
</ol>

<p><a name="queries"><b>4.&nbsp;&nbsp;Queries</b></a> - Use queries to examine
the state of the room and wait indefinitely until certain events occur.</p>
<ol>
  <li><a name="question"><b>Question</b></a> - If one or more <a href="#answer">
      <b>Answer option</b></a> commands have been provided previously in script
      execution, this will ask the user a multiple choice question with the
      dialogue you specify and answer options previously provided. Script
      execution will continue from the label of the Answer option selected by
      the player.  Once a <b>Question</b> has been asked, the list of Answer
      options is reset for the next <b>Question</b>.<br />
      If no <a href="#answer"><b>Answer option</b></a> commands have been
      provided before this command is executed, the user will be asked a "Yes"
      or "No" question with the dialogue you specify. If a yes/no
      <b>Question</b> is executed as the condition for an <a href="#if">
      <b>If ...</b></a> command, the corresponding script block will execute if
      the user answers "Yes".</li>
  <li><a name="wait"><b>Wait</b></a> - This tells the NPC to do nothing until
      the number of game turns you specify has passed.  <b>Wait 0</b> will stop
      the script at the current point until the next turn.</li>
  <li><a name="waitevent"><b>Wait for event</b></a> - The NPC waits until the
      specified game event has taken place. If the event has not taken place, and
      the command is not being used as a condition for an If command, another check
      will be performed at the end of the turn, and the script will continue on the
      next turn if the specified event has taken place. This also occurs if it is in a
      <a href="#logical-wait">multi-expression wait</a>. In this case, be
      aware that other conditions may have changed between the intial check and
      end-of-turn check.</li>
  <li><a name="waitentity"><b>Wait for entity</b></a> - The NPC waits for any of
      the selected entity type (or entities) to enter the room region you
      specify.  Hold &lt;Ctrl&gt; while clicking to select and unselect multiple
      selections.  After selecting this command, the room will temporarily
      appear.  Hold down the mouse button and drag the mouse cursor to select
      the area any of the entity or entities must enter before the NPC does
      anything else.</li>
  <li><a name="waitentityis"><b>Wait while entity</b></a> - Wait while any of
      the selected entity type remains in the room region that you select.</li>
  <li><a name="waitdoor"><b>Wait for door to (open/close)</b></a> - Waits for
      the door at the selected room square to either open or close.</li>
  <li><a name="waitturn"><b>Wait for turn</b></a> - The NPC does nothing until
      at least the specified number of game turns has passed since the player
      entered the room.</li>
  <li><b>Wait for turn</b> - Waits until the player has made the specified
      number of moves in the room.</li>
  <li><a name="waitplayerface"><b>Wait for player to face</b></a> - Waits until
      the player turns in the specified direction.</li>
  <li><a name="waitplayermove"><b>Wait for player to move</b></a> - Waits until
      the player moves in the specified direction.</li>
  <li><a name="waitplayertouch"><b>Wait for player to touch me</b></a> - Waits
      until the player bumps into the NPC.</li>
  <li><a name="waitvar"><b>Wait until var</b></a> - Waits until a <a href="#setvar">
      hold variable</a> meets the condition you specify.</li>
  <li><a name="wait-expression"><b>Wait until expression</b></a> - Waits until a given expression satisfies the condition you specify. In addition to hold variables, expressions can also use <a href="#functions">function primitives</a>. Expressions can only be compared to constant values.</li>
  <li><a name="waitdefeat"><b>Wait for defeat</b></a> - Waits until the
      NPC has been defeated (i.e. its HP has been reduced to zero).
	  This must be used in conjunction with
	  <a href="#impinvulnerable">Imperative: Unkillable</a> in order to create
	  an NPC that may be defeated in battle but continue to execute commands
	  afterward.  After the NPC has been defeated, its defeated status may
	  be undone by resetting its HP to a nonzero value.  Other sources of 
	  damage, such as briars or bomb-blasts, will also flag the NPC as
	  defeated.</li>
  <li><a name="waitforopenmove"><b>Wait for open move</b></a> - Wait until the
      NPC is able to make a move in the specified direction.  When rotations
	  are considered, they will check for a "safe" turn, i.e. that a sword-
	  wielding NPC would not harm itself by striking a bomb.  Hint: Use this
	  query to test whether a move may be made before executing a
	  <a href="#move">Move</a> command in that direction.</li>
  <li><a name="wait-for-open-tile"><b>Wait for open tile</b></a> - Wait until the
    tile at the specified location is open, according to the specified movement type.
    Additionally, this command can be configured to ignore tile-blocking weapons and entities.
    Hold &lt;Ctrl&gt; while clicking to select and unselect multiple selections for ignorable entities.</li>
  <li><a name="waitforitem"><b>Wait for item</b></a> - Wait until the
      specified element is located in the marked room region.</li>
  <li><a name="waitforitemgroup"><b>Wait for item group</b>
    </a> - Wait until any element from the specified group is located in the marked room region.</li>
  <li><a name="waitwhileitemgroup"><b>Wait while item group</b>
    </a> - Wait until no elements from the specified group are located in the marked room region.</li>
  <li><a name="waitforweapon"><b>Wait for weapon</b></a> - Wait until a
      weapon is located in the marked room region.</li>
  <li><a name="logical-wait"><b>Multi-expression Waits</b></a> - Multi-expression wait commands are used to perform an atomic check on multiple conditions, i.e., as a single combined boolean query, which returns a single true or false value. Script execution halts at this point until the multiple conditions are met as specified. The expression block begins with <b>Wait for All</b>, <b>Wait for Any</b> or <b>Wait for Exactly One</b> command, and should end with a <b>Wait for Conditions End</b> command. An <b>All</b> block will wait until all subqueries are true, an <b>Any</b> block will wait until any subquery is true, and an <b>Exactly One</b> block will wait until exactly one subquery is true. Additionally, a multi-expression wait block can be used as a condition for an <a href="#if">if statement</a>. Multi-expression wait blocks can be nested if more complex logic is required. All "Wait for" commands can be used as subqueries, along with the <a href="#role">Set role</a> and <a href="#set-movement">Set movement type</a> commands, which function as they do when used as an if condition.</li>
</ol>

<p><a name="decision"><b>5.&nbsp;&nbsp;Decision making</b></a> - Use the
following commands to execute only a marked portion of script commands or to
continue executing script commands from a different location in the script.</p>
<ol>
  <li><a name="if"><b>If ...</b></a> - Use this command to optionally run a
      block of one or more script commands, based on a condition you specify in
      the next script command, which must be a query. If the query is
      immediately satisfied, then the script commands that follow after will be
      executed.  An <a href="#ifend"><b>If End</b></a>,
      <a href="#else"><b>Else</b></a> or <a href="#else-if"><b>Else if</b></a> command indicates the end of the optional
      code block. If the following query is not true, the script will continue
      after the following the next <a href="#else"><b>Else</b></a> or
      <a href="#ifend"><b>If End</b></a> command that marks the end of the
      optional code block.</li>
  <li><a name="if"><b>If ...</b></a>. The end of the <a href="#else"><b>Else</b></a>
      block is indicated with an <a href="#ifend"><b>If End</b></a> command.</li>
  <li><a name="else"><b>Else</b></a> - Marks the beginning of a script section
      that is executed if the query condition following the
      <a href="#if"><b>If ...</b></a> command is <u>not</u> satisfied.
      <b>Else</b> commands in conditional blocks are optional, but they must
      always follow somewhere after an <a href="#if"><b>If ...</b></a> to be
      meaningful.</li>
  <li><a name="else-if"><b>Else if</b></a> can optionally be used instead of <a href="#else"><b>Else</b></a> to avoid nesting script commands. It works exactly the same as nesting an <a href="#if"><b>If ...</b></a> <a href=  "#ifend"><b>If End</b></a> block inside an <a href="#else"><b>Else</b></a></li>
  <li><a name="ifend"><b>If End</b></a> - Marks the end of
      <a href="#if"><b>If ...</b></a> and <a href="#else"><b>Else</b></a> blocks.<br />
      <a name="condnotes">Notes:</a>
      <ol>
        <li>A "?" symbol displayed in front of a command in the script list
            means the command is not a recognized as a valid condition for an
            <a href="#if"><b>If ...</b></a> command.</li>
        <li><a href="#if"><b>If ...</b></a> commands may be nested, i.e., an
            inner code block may be completely contained within an outer code
            block.</li>
        <li>A "!" symbol displayed in front of a command in the script list
            means that an <a href="#if"><b>If ...</b></a> or
            <a href="#else"><b>Else</b></a> block is not properly closed with an
            <a href="#ifend"><b>If End</b></a> command at the end, or that an
            <a href="#else"><b>Else</b></a> command is placed without an
            <a href="#if"><b>If ...</b></a> coming first.</li>
        <li>See "<a href="#branchingexamples">Examples of branching code
             structures</a>" below.</li>
      </ol></li>
  <li><a name="label"><b>Label</b></a> - marks a location in the script to
      continue executing commands from (used in conjunction with
      <a href="#goto"><b>Go to</b></a>, <a href="#answer"><b>Answer option</b></a>,
	  <a href="#eachattack"><b>Each Attack</b></a>,
	  <a href="#eachdefend"><b>Each Defend</b></a>
	  and <a href="#eachuse"><b>Each Use</b></a>
      commands).  Also, labels may be used to simply comment in normal language
      on what the following script commands do.</li>
  <li><a name="goto"><b>Go to</b></a> - Select a label to continue executing
      commands from.  Hint: Use Goto to make a loop in the script that repeats a
      sequence of commands over and over. Use a <a href="#wait"><b>Wait 0</b></a>
      command as the last statement of a loop that is to be executed once each
      turn.</li>
  <li><a name="gosub"><b>Gosub</b></a> - Similar to "Go to", it continues execution from the indicated label. Used in conjunction with "Return" for more modular scripting.</li>
  <li><a name="return"><b>Return</b></a> - Continue executing commands from the most recent "Gosub" command executed. When multiple Gosub commands are executed, then multiple Return commands will jump back to these in order from most to least recent.</li>
  <li><a name="endonexit"><b>End on room exit</b></a> - Removes the NPC for the
      rest of the current game when the room is exited.
	  Hint: use this command at the start of a script to have the NPC execute
	  commands until the player exits the room, and then never appear again.</li>
  <li><a name="end"><b>End</b></a> - Ends the character script executing
      immediately, and the NPC will be removed from the room for the rest of the
	  current game when the room is exited. Hint: use this command to permanently
	  stop the NPC from executing any more commands, and then disappear when
	  the room is exited.</li>
</ol>
<p><a name="lighting"><b>6.&nbsp;&nbsp;Lighting</b></a> - The following commands can be used to alter the lighting layer of a room. Only one type of lighting can be present on a tile, so these commands will overwrite pre-existing tile lighting. Architects should be considerate to players, and not excessively change the lighting of a room during play.</p>
<ol>
  <li><a name="set-dark"><b>Set ceiling darkness</b></a> - Adds darkness to an area. Values between 1 and 32 inclusive will darken a tile, while a value of zero will remove lighting from the tile. Values outside of this range will be clamped to the valid range.</li>
  <li><a name="set-light"><b>Set ceiling light</b></a> - Adds colored light to an area. Any of the 16 predefined colors can be used. Selecting 'none' will remove lighting from the tile.</li>
  <li><a name="set-wall-light"><b>Set wall light</b></a> - Adds a wall light element to a tile, with the given intensity. Any of the 16 predefined colors can be used, with an intensity between 1 and 8 inclusive. Selecting 'none' or setting an intensity of zero will remove lighting from the tile.</li>
</ol>

<br />

<p><a name="usagenotes"><b>Notes about using NPC scripts</b></a></p>
<ol>
  <li><a name="lifecycle">Each</a> character script begins execution when the
      room is first entered. Upon room reentry,
      the script will continue where it left off by default.</li>
  <li><a name="restart">A</a> script can be made to restart from the
      beginning when the player reenters the room by executing an
	  <a href="#restartscript"><b>Imperative: Restart script on entrance</b></a>
      command at the anywhere within the script.</li>
  <li>NPCs with <a href="#end"><b>End</b></a>ed scripts will not
      appear in the room when the player enters it in the future.</li>
  <li>An NPC can be turned into a regular monster of its specified entity type
      with the
      <a href="#turnintomonster"><b>Turn into monster</b></a> command, but
	  it might be preferable to set stat vars for the NPC so the player
	  may fight it in its current form.</li>
</ol>

<p><a name="imperativelist"><b>Imperatives</b></a> - NPC/script properties
that may be set with the <a href="#imperative">Imperative</a> command.</p>
<ol>
  <li><a name="impvulnerable"><u>Killable</u></a>: Makes the NPC vulnerable to
      killing (default).</li>
  <li><a name="impinvulnerable"><u>Unkillable</u></a>: Makes the NPC
      invincible so it cannot be killed by combat or other methods of
      inflicting damage. When an unkillable NPC has its HP dropped to zero, its 
	  "defeated" flag is set (see <a href="#waitdefeat">Wait For Defeat</a>).
	  Non-flying NPCs may still be killed by dropping them off a platform.
      </li>
  <li><a name="impcritical"><u>Critical hero</u></a>: When set, the room will
      automatically restart if the NPC is ever killed.</li>
  <li><a name="impsafe"><u>Safe</u></a>: Forbids the NPC to harm the player,
      by engaging in combat when bumping into the player, and vice-versa.</li>
  <li><a name="impswordsafe"><u>Sword safe to player</u></a>: Sword stabs from
      this NPC won't harm the player.</li>
  <li><a name="impdeadly"><u>Deadly</u></a>: Allows the NPC to bump into the
      player to engage in combat.  Also makes sword hits harm to the player
	  according to the ATK rating of the NPC (default).</li>
  <li><a name="impdie"><u>Die</u></a>: Makes the NPC die with a blood splatter.</li>
  <li><a name="hidestatchanges"><u>Hide stat changes</u></a>: Makes
	  <a href="#setvar">Set Var</a>
	  commands that alter the player's stats not display as game effects.</li>
  <li><a name="showstatchanges"><u>Showstat changes</u></a>: Makes
	  <a href="#setvar">Set Var</a>
	  commands that alter the player's stats display as game effects (default).</li>
  <li><a name="ghost"><u>Ghost display</u></a>: When the NPC is not in the room,
	  the NPC's image will appear at its current coordinates anyway.</li>
  <li><a name="noghost"><u>No ghost display</u></a>: When the NPC is not in the room,
	  it is not displayed (default).</li>
  <li><a name="restartscript"><u>Restart script on entrance</u></a>: When the
	  player reenters the room, the NPC's script and internal state vars will
	  restart from the beginning.</li>
  <li><a name="norestartscript"><u>No restart on entrance</u></a>: When the
	  player reenters the room, the NPC's script and internal state vars will
	  continue as they left off when the room was last exited (default).</li>
  <li><a name="makescriptglobal"><u>Make script global</u></a>: When executed,
	  the NPC and its script are removed from the room into a list of global scripts.
	  Global scripts continue to execute for the duration of the current
	  game, within all rooms.
      Once a script is in the global list, it may no longer re-enter
	  the player's current room as an NPC with the Appear command variants.
	  If an <a href="#end">End</a> command variant is executed, the
	  script terminates as usual.
	  Hint: use this to create a script that can make things happen in any room
	  or check for things happening at any time during play,
	  not only in a particular room.
      <u>LIMITATION</u>: only available within default scripts of custom NPCs.</li>
</ol>

<p><a name="behaviorlist"><b>Behaviors</b></a> - NPC behaviors and attributes
that may be set with the <a href="#behavior">Behavior</a> command.</p>
<ol>
  <li><a name="be_standard"><u>Standard</u></a>: Reverts the NPC to no
	  special behavior pattern or attributes (default).</li>
  <li><a name="be_face"><u>Face target</u></a>: Face toward the player.</li>
  <li><a name="be_faceaway"><u>Face away from target</u></a>: Face away from
	  the player.</li>
  <li><a name="be_attackfrontback"><u>Attack in front with back turned</u></a>:
	  Attack(<a href="#attack">*</a>) whenever the player is in front of the NPC and has his back
	  turned.</li>
  <li><a name="be_attackfront"><u>Attack in front</u></a>:
	  Attack(<a href="#attack">*</a>) whenever the player is in front of the NPC.</li>
  <li><a name="be_attack"><u>Attack adjacent</u></a>:
	  Attack(<a href="#attack">*</a>) whenever the player is adjacent the NPC.</li>
  <li><a name="be_beam"><u>Beam attack</u></a>:
	  NPC emits a beam that halves the player's health on contact.</li>
  <li><a name="be_beam_block"><u>Beam blocker</u></a>:
      Embues custom equipment with the ability to block beam attacks. Swords will prevent beams passing through them, shields protect from beams the player is facing, and accessories will protect from beams in all directions.</li>
  <li><a name="be_hot_tile_immune"><u>Heatproof</u></a>:
      Prevents the NPC from being harmed by hot tiles, and custom equipment with this ability protects the player from hot tiles.</li>
  <li><a name="be_firetrap_immune"><u>Fireproof</u></a>:
      Prevents the NPC from being harmed by firetraps, and custom equipment with this ability protects the player from firetraps.</li>
  <li><a name="be_mist_immune"><u>Mist protection</u></a>:
      The NPC's DEF is not nullified by mist, and custom equipment with this ability stops the player's DEF being nullified by mist.</li>
  <li><a name="be_surprised"><u>Surprised from behind</u></a>:
	  If the player attacks a monster with this attribute from behind,
	  the NPC loses its first attack turn.  For equipment, it gives the player's
	  first hit x2 ATK when hitting the monster first from behind.</li>
  <li><a name="be_spawn_eggs"><u>Spawn Eggs</u></a>:
      NPC will generate roach eggs or another monster type when the player engages another monster in combat. The type of monster generated can be controlled by the <b>_MySpawn</b> and <b>_QueenSpawn variables</b>.</li>  
  <li><a name="be_goblin"><u>Goblin Weakness</u></a>:
	  NPC is weak to goblin blades (i.e. player gets x2 ATK).
	  Embues custom equipment with goblin blade attribute. Shields with goblin blade attribute instead provide x2 DEF against attacks from goblin enemies.</li>
  <li><a name="be_wyrm"><u>Wyrm Weakness</u></a>:
	  NPC is weak to wyrm blades (i.e. player gets x2 ATK).
	  Embues custom equipment with wyrm blade attribute. Shields with wyrm blade attribute instead provide x2 DEF against attacks from wyrm enemies.</li>
  <li><a name="be_metal"><u>Metal</u></a>:
      Metal monsters will be damaged on oremites the same as if on a hot tile.
	  Embues custom equipment with metal attribute (disabled on oremites).</li>
  <li><a name="be_wall_dwelling"><u>Wall-dwelling</u></a>:
      A wall-dwelling monster will die if it is not on wall or closed door tile.</li>
  <li><a name="be_lucky"><u>Lucky</u></a>:
	  Embues custom equipment with lucky attribute (x2 GR from combat
	  for each lucky item held).</li>
  <li><a name="be_luckyREP"><u>REP Doubler</u></a>:
	  Embues custom equipment with REP doubler attribute (x2 REP from combat
	  for each REP doubler item held).</li>
  <li><a name="be_briar"><u>Briar cutter</u></a>:
	  NPC can cut briars with its sword.
	  Embues custom equipment with briar-cutting attribute (the player's
	  sword can cut briars).</li>
  <li><a name="be_cuttar"><u>Cut tarstuff anywhere</u></a>:
	  NPC can cut tarstuff at any position, not just weak points.
	  Embues custom equipment with tar-cutting attribute (the player's
	  sword can cut tarstuff at any position).</li>
  <li><a name="be_noenemydefense"><u>No enemy defense</u></a>:
	  Attacks nullify the enemy's DEF rating.  Embues custom armor with
	  protection against monsters with this attack ability.</li>
  <li><a name="be_attackfirst"><u>Attack first</u></a>:
	  Get first attack against the enemy.  Embues custom armor and accessory with
	  protection against monsters with this attack ability.</li>
  <li><a name="be_attacklast"><u>Attack last</u></a>:
	  Always attack last against the enemy.</li>
  <li><a name="be_attacklast"><u>Removes sword</u></a>:
	  A piece of equipment with this behavior will prevent the player from holding a sword, even if they have a weapon equipped. The player still benefits from the weapon's stat increases, and any other scripted effects it may have.</li>
  <li><a name="be_droptrapdoors"><u>Drop Trapdoors</u></a>:
	  When moving off trapdoors, setting this causes them to drop.
	  Otherwise, nothing happens (default).</li>
  <li><a name="be_moveintoswords"><u>Move Into Swords</u></a>:
	  Allows the NPC to move onto swords.
	  Otherwise, it is not allowed (default).</li>
  <li><a name="be_pushobjects"><u>Push Objects</u></a>:
	  Allows the NPC to push mirrors and move platforms.
	  Otherwise, it is not allowed (default).</li>
  <li><a name="be_explodesafe"><u>Explosive safe</u></a>:
	  A piece of equipment with this behavior will prevent the player's sword from detonating bombs and powder kegs, allowing kegs to be pushed with the sword. An NPC with this behavior will not detonate bombs or kegs with their sword.</li>
    <li><a name="be_wallsafe"><u>Wall and mirror safe</u></a>:
	  A piece of equipment with this behavior will prevent the player's sword from breaking walls and shattering mirrors. An NPC with this behavior will not break walls or shatter mirrors with their sword.</li>
  <li><a name="be_directonlymovement"><u>Direct-only movement</u></a>: If the
      target is in a diagonal direction from the NPC, but
	  diagonal movement is blocked, then don't move at all.  If the target is
	  in an orthogonal direction, attempt to move along a straight path to
	  the target.</li>
  <li><a name="be_normalmovement"><u>Normal movement</u></a>: When a
	  desired diagonal movement is blocked, then choose vertical movement,
	  if possible, otherwise choose a horizontal movement to approach the
	  destination (default).</li>
  <li><a name="be_smartermovement"><u>Smarter movement</u></a>: When a
	  desired diagonal movement is blocked, then choose the better of
	  horizontal or vertical movement to approach the destination.</li>
  <li><a name="be_omnimovement"><u>Omni movement</u></a>: When a
	  desired diagonal or orthogonal movement is blocked, then attempt to make
	  a movement to the side that might help to approach the destination.</li>
  <li><a name="be_minimaptreasure"><u>Minimap treasure</u></a>:
      A character with this behavior will count as a collectable item for the purpose of setting the room color on the minimap. This only applies if the character is visible or has the <a href="#ghost">Ghost display</a> imperative.</li>
</ol>
<p><a name="attack"><b>*Attack</b></a> - Monsters may not attack the player
when the player is above the monster, e.g. standing on a raised door when
the monster is not.
</p>

<p><a name="predefinedvars"><b>Predefined vars</b></a> - There are several
predefined variables that may be set and queried with the
<a href="#setvar">Set var</a> and <a href="#waitvar">Wait until var</a> commands.
Some of these variables are tied to game state and are updated automatically
as play progresses.  Others are altered solely through script commands.
These variables may be referenced in script expressions.
The variable names are case-insensitive.
<br /><br />
<table>
  <tr>
    <td width="200"><b>Name</b></td><td width="340"><b>Description</b></td><td width="170"><b>Default value</b></td><td width="150"><b>Valid range</b></td>
  </tr><tr>
    <td><b>NPC stats</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_MyHP</td><td>NPC's HP</td><td>0 (<a href="#myhp">*</a>)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MyATK</td><td>NPC's ATK</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyDEF</td><td>NPC's DEF</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyGold</td><td>NPC's GR (battle loot)</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyREP</td><td>NPC's REP (battle loot)</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyColor</td><td>NPC's RGB modifier (<a href="#mycolor">*</a>)</td><td>505050</td><td>000000,999999</td>
  </tr><tr>
    <td>_MyHue</td><td>NPC's base color modifier (<a href="#myhue">*</a>)</td><td>0</td><td>0,6000</td>
  </tr><tr>
    <td>_MySaturation</td><td>NPC's color strength modifier (<a href="#mysaturation">*</a>)</td><td>0</td><td>0,1000</td>
  </tr><tr>
    <td>_MySword</td><td>NPC's sword type (<a href="#mysword">*</a>)</td><td>-1 (use base type)</td><td>-1,9</td>
	</tr><tr>
    <td>_MyWeakness</td><td>NPC's custom weakness type (<a href="#myweakness">*</a>)</td><td></td><td>Text</td>
  </tr><tr>
    <td>_MyDescription</td><td>NPC's custom description (<a href="#mydescription">*</a>)</td><td></td><td>Text</td>
  </tr><tr>
    <td>_MyX</td><td>NPC's X coordinate (room column)</td><td></td><td>0,15</td>
  </tr><tr>
    <td>_MyY</td><td>NPC's Y coordinate (room row)</td><td></td><td>0,15</td>
  </tr><tr>
    <td>_MyO</td><td>NPC's orientation (direction faced)</td><td></td><td>0,8</td>
  </tr><tr>
    <td>_MyScriptX</td><td>NPC's command X param override(<a href="#paramoverride">*</a>)</td><td>-9999 (no override)</td><td>by command</td>
  </tr><tr>
    <td>_MyScriptY</td><td>NPC's command Y param override</td><td>-9999 (no override)</td><td>by command</td>
  </tr><tr>
    <td>_MyScriptW</td><td>NPC's command W param override</td><td>-9999 (no override)</td><td>by command</td>
  </tr><tr>
    <td>_MyScriptH</td><td>NPC's command H param override</td><td>-9999 (no override)</td><td>by command</td>
  </tr><tr>
    <td>_MyScriptF</td><td>NPC's command Flags param override</td><td>-9999 (no override)</td><td>by command</td>
  </tr><tr>
    <td><b>Game state modifiers</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_MonsterHPMult</td><td>global monster HP multiplier(<a href="#monhpmult">*</a>)</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MonsterATKMult</td><td>global monster ATK multiplier</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MonsterDEFMult</td><td>global monster DEF multiplier</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MonsterGRMult</td><td>global monster GR multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MonsterREPMult</td><td>global monster REP multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyMonsterHPMult</td><td>local monster HP multiplier(<a href="#mymonhpmult">*</a>)</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MyMonsterATKMult</td><td>local monster ATK multiplier</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MyMonsterDEFMult</td><td>local monster DEF multiplier</td><td>100 (percent)</td><td>0,MAX</td>
  </tr><tr>
    <td>_MyMonsterGRMult</td><td>local monster GR multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyMonsterREPMult</td><td>local monster REP multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_LevelMultiplier</td><td>current level's item stat multiplier(<a href="#levelmult">*</a>)</td><td></td><td></td>
  </tr><tr>
    <td>_ItemMult</td><td>global item stat multiplier(<a href="#itemmult">*</a>)</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ItemHPMult</td><td>global health item multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ItemATKMult</td><td>global ATK power-up multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ItemDEFMult</td><td>global DEF power-up multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ItemGRMult</td><td>global money door multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyItemMult</td><td>local item stat multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyItemHPMult</td><td>local health item multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyItemATKMult</td><td>local ATK power-up multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyItemDEFMult</td><td>local DEF power-up multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_MyItemGRMult</td><td>local money door multiplier</td><td>100 (percent)</td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_HotTile</td><td>hot tile damage(<a href="#damage">*</a>)</td><td>5 (percent)</td><td>-MAX,100</td>
  </tr><tr>
    <td>_Explosion</td><td>explosion damage(<a href="#damage">*</a>)</td><td>100 (percent)</td><td>-MAX,100</td>
  </tr><tr>
    <td>_Beam</td><td>beam damage(<a href="#damage">*</a>)</td><td>50 (percent)</td><td>-MAX,100</td>
  </tr><tr>
    <td>_Firetrap</td><td>fire trap damage(<a href="#damage">*</a>)</td><td>-1000</td><td>-MAX,100</td>
  </tr><tr>
    <td>_MudSpawn</td><td>global mud spawn entity ID(<a href="#spawn">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_TarSpawn</td><td>global tar spawn entity ID(<a href="#spawn">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_GelSpawn</td><td>global gel spawn entity ID(<a href="#spawn">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_QueenSpawn</td><td>global roach queen spawn entity ID(<a href="#spawn">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_MySpawn</td><td>local NPC spawn entity ID(<a href="#spawn">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_MudSwap</td><td>global mud switcher entity ID(<a href="#swap">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_TarSwap</td><td>global tar switcher entity ID(<a href="#swap">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
    <td>_GelSwap</td><td>global gel switcher entity ID(<a href="#swap">*</a>)</td><td>-1 (default)</td><td>valid entity ID</td>
  </tr><tr>
	<td>_ScoreHP</td><td>score value for each HP(<a href="#scorevars">*</a>)</td><td>-40</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreATK</td><td>score value for each ATK</td><td>5</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreDEF</td><td>score value for each DEF</td><td>3</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreYellowKeys</td><td>score value for each yellow key</td><td>10</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreGreenKeys</td><td>score value for each green key</td><td>20</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreBlueKeys</td><td>score value for each blue key</td><td>30</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreSkeletonKeys</td><td>score value for each skeleton key</td><td>30</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreGR</td><td>score value for each GR</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
	<td>_ScoreREP</td><td>score value for each REP</td><td>0</td><td>-MAX,MAX</td>
  </tr><tr>
    <td><b>Player stats</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_HP</td><td>player's HP</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_Attack</td><td>player's ATK</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_Defense</td><td>player's DEF</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_Gold</td><td>player's GR</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_REP</td><td>player's REP</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_YellowKeys</td><td>player's yellow keys</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_GreenKeys</td><td>player's green keys</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_BlueKeys</td><td>player's blue keys</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_SkeletonKeys</td><td>player's skeleton keys</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_Sword</td><td>player's sword type</td><td></td><td>0,9</td>
  </tr><tr>
    <td>_Shield</td><td>player's shield type</td><td></td><td>0,5</td>
  </tr><tr>
    <td>_Accessory</td><td>player's accessory type</td><td></td><td>0,11</td>
  </tr><tr>
    <td>_X</td><td>player's X coordinate (room column)</td><td></td><td>0,15</td>
  </tr><tr>
    <td>_Y</td><td>player's Y coordinate (room row)</td><td></td><td>0,15</td>
  </tr><tr>
    <td>_O</td><td>player's orientation (direction faced)</td><td></td><td>0,8</td>
  </tr><tr>
    <td>_RoomX</td><td>current room's X coordinate in level(<a href="#roompositionvars">*</a>)</td><td></td><td></td>
  </tr><tr>
    <td>_RoomY</td><td>current room's Y coordinate in level(<a href="#roompositionvars">*</a>)</td><td></td><td></td>
  </tr><tr>
    <td><b>Play info</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_TotalMoves</td><td>total moves made by the player this game</td><td></td><td></td>
  </tr><tr>
    <td><b>Combat stats</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_EnemyHP</td><td>Enemy's HP(<a href="#enemy">*</a>)</td><td></td><td>0,MAX</td>
  </tr><tr>
    <td>_EnemyATK</td><td>Enemy's ATK</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_EnemyDEF</td><td>Enemy's DEF</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_EnemyGR</td><td>Enemy's GR (battle loot)</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_EnemyREP</td><td>Enemy's REP (battle loot)</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td><b>Equipment values</b></td><td></td><td></td><td></td>
  </tr><tr>
    <td>_WeaponATK</td><td>player weapon ATK(<a href="#equipquery">*</a>)</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_WeaponDEF</td><td>player weapon DEF</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_WeaponGR</td><td>player weapon GR</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ArmorATK</td><td>player armor ATK</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ArmorDEF</td><td>player armor DEF</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_ArmorGR</td><td>player armor GR</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_AccessoryATK</td><td>player accessory ATK</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_AccessoryDEF</td><td>player accessory DEF</td><td></td><td>-MAX,MAX</td>
  </tr><tr>
    <td>_AccessoryGR</td><td>player accessory GR</td><td></td><td>-MAX,MAX</td>
  </tr>
</table>
</p>

<p><a name="myhp"><b>*_MyHP</b></a> - In order for an NPC to
  engage the player in combat, its HP stat must be set to a value
  greater than zero (the default).  You probably want to set the ATK, DEF, GR,
  and REP values as well.
</p>
<p><a name="mycolor"><b>*_MyColor</b></a> - a six-digit number, where each
  two-digit pair defines the
  amount of R/G/B color offset to the NPC's image.  A value of 50 is normal.
  Lower values (0-49) remove a proportionate amount of that color.
  Greater values (51-99) enhance that color. This alteration is applied after changes
  to hue and saturation.
</p>
<p><a name="myhue"><b>*_MyHue</b></a> - a number between 0 and 6000, inclusive. If it
    is set to a non-zero value, it will change the base color of the NPC's image. At a 
    value of 1, the image is shifted to red. Increasing values will shift to orange, yellow,
    blue, green, indigo and violet, before cyling back to red as the value approaches 6000. Black,
    white and greys in the character's image are not affected by this change.
</p>
<p>
    <a name="mysaturation"><b>*_MySaturation</b></a> - a number between 0 and 1000,
    inclusive. If it is set to a non-zero value, it will change the base colors of
    the NPC's image. Lower values make the colors less intense, while higher values
    make them more intense.
</p>
<p><a name="mysword"><b>*_MySword</b></a> - set this to change what kind of
  sword the NPC wields.  This affects the NPC's appearance only, and does
  not alter the NPC's ATK rating.
  See <a href="equipment.html">Equipment</a> for
  available choices, numbered in order of appearance.
  A value of 0 indicates no sword.
</p>
<p><a name="myweakness"><b>*_MyWeakness</b></a> - Allows a custom weakness to be set for a monster or equipment. A semi-colon can be used to split the weakness into multiple weaknessess that are checked separately. A weapon or accessory is strong (i.e. player gets x2 ATK) against a monster if the two have a matching _MyWeakness value. A shield can also be strong against a monster, and will give x2 DEF against attacks from it. The comparison is case-sensitive, so for example the values "Eyeball" and "eyeball" would not be considered the same.
</p>
<p><a name="mydescription"><b>*_MyDescription</b></a> - A custom description property that can be set for a monster or equipment. It will be displayed after any behavior descriptors that apply to the character. A semi-colon can be used to split the description into multiple descriptors that will be displayed separately.
</p>
<p><a name="paramoverride"><b>*_MyScriptX</b></a> - This and the other script
  command parameter overrides are used if variable parameters are required
  for certain script commands instead of hard-coded values.
  This applies to commands:
  AppearAt (x,y), MoveTo (x,y), Move (x,y), FaceDirection (x),
  ActivateItemAt (x), Wait (x turns), WaitForRect (x,y,w,h,flags),
  WaitWhileRect (x,y,w,h,flags), WaitForDoorTo (x,y), WaitForTurn (x),
  WaitForPlayerToFace (x), WaitForPlayerToMove (x), WaitForOpenMove (x),
  LevelEntrance (y=display text or not), CutScene (x=speed),
  AmbientSoundAt (x,y), PlayVideo (x,y), BuildTiles (x,y,w,h,flags),
  WaitForItem (x,y,w,h,flags).  <b>Note:</b> You must remember to reset
  parameter override vars to -9999 (their default value) after executing a
  command with variable parameters in order to ensure later commands are not
  affected unintentionally by your parameter overrides.
</p>
<p><a name="monhpmult"><b>*_MonsterHPMult</b></a> - This value is a percent
  multiplier.  It is applied to
  a predefined monster's base HP when the player first enters the room.
  The other stat multipliers are applied to the monster's base stats during
  combat.
</p>
<p><a name="mymonhpmult"><b>*_MyMonsterHPMult</b></a> - This value is a percent
  multiplier. It is a local version of the monster HP multiplier.
  Local modifiers stack multiplicatively with global modifiers, and are applied
  by NPCs and custom player equipment.
</p>
<p><a name="mymonhpmult"><b>*_ItemMult</b></a> - This value is a percent
  multiplier. Item multipliers are applied to items of the appropriate type,
  and are available in global and local versions, and are applied when items are
  collected. If the total multiplier for an item is negative, collecting it will
  reduce the player's statistics.
</p>
<p><a name="levelmult"><b>*_LevelMultiplier</b></a> - This value contains the currents level's item multiplier, as set in the editor. It is a read-only value.
</p>
<p><a name="roompositionvars"><b>*_RoomX, _RoomY</b></a> - These values contain the X and Y position of the current room in the level. The entrance is at (0,0), with East and South being positive directions, and North and West being negative directions. These are read-only values.
</p>
<p><a name="damage"><b>*_HotTile, _Explosion, _Beam, _Firetrap</b></a> - When damage is set to a
  positive value, it indicates the percentage of HP the target will
  lose.  A negative value indicates a flat damage to inflict.
  When the player is hasted by a Speed Potion, expected damage is halved.
</p>
<p><a name="spawn"><b>*_MudSpawn, _TarSpawn, _GelSpawn, _QueenSpawn, _MySpawn</b></a> - Overrides
  the monster type produced by mud, tar, gel and roach queens respectively. NPCs with the <a href="#be_spawn_eggs">Spawn eggs</a>
  behavior will produce the monster specified by _QueenSpawn if they do not have a value set for _MySpawn. Overriding tarstuff
  spawns will also change the monsters affected and produced by <a href="elements.html#tarstuffswitcher">tarstuff switchers</a>.
</p>
<p><a name="swap"><b>*_MudSwap, _TarSwap, _GelSwap</b></a> - Overrides the monster types affected and produced by 
  <a href="elements.html#tarstuffswitcher">tarstuff switchers</a> to be something other than tarstuff mothers. This set of monsters
  is separate from the ones defined by the spawn override variables. Multi-tile monsters cannot be swapped, either as the source or
  result of swapping.
</p>
<p><a name="enemy"><b>*_EnemyHP, _EnemyATK, _EnemyDEF, _EnemyGR, _EnemyREP</b></a> - 
  These vars are only applicable when in combat.  Custom equipment may
  query or set these values to affect the enemy being fought.  When used by
  the script of the monster being fought itself, its own stats are affected.
</p>
<p><a name="equipquery"><b>*_WeaponATK, _WeaponDEF, _WeaponGR,
  _ArmorATK, _ArmorDEF, _ArmorGR,
  _AccessoryATK, _AccessoryDEF, _AccessoryGR</b></a> - 
  These vars reference the stat values of the player's current equipment.
  When predefined equipment is carried, its values may be queried but not
  altered.
</p>
<p><a name="totalstats"><b>*_TotalATK, _TotalDEF</b></a> - These vars are equal to the player's total ATK and DEF stats 
    after applying the effects of equipment and room elements. These are read-only values.
</p>
<p><a name="scorevars"><b>*_ScoreHP, _ScoreATK, _ScoreDEF, _ScoreYellowKeys,
  _ScoreGreenKeys, _ScoreBlueKeys, _ScoreSkeletonKeys, _ScoreGR, _ScoreREP</b></a> - 
  These vars determine how much each of the player's resources is worth for scoring
  at score checkpoints. A positive value will make each one worth that much.  A
  negative value will divide your total by that amount, rounding down.  A value of 0
  will cause it to not be listed on score checkpoints.  Each resource is capped at a
  total score of 100 million, if you are likely to reach this cap, you should lower
  your score multiplier.  <b>Note:</b> Players can look at their current score at any
  time by right-clicking on the player character, so you should set these values at
  the earliest opportunity.
</p>

<p><a name="functions"><b>Function primitives</b></a> - Predefined
  functions may be inserted anywhere a variable is referenced. The function will
  return a value based on the input parameters and current game context, where applicable.
  Functions are useful to apply in variable expressions.
  All inputs must either be integer values or an expression that resolves to an integer value.
  All outputs are likewise integers.
  Function names are case-insensitive.
</p>
<p><a name="abs">* <b>_abs(x)</b></a> - Returns the absolute value of x</p>
<p><a name="min">* <b>_min(x,y)</b></a> - Returns the lesser of two values</p>
<p><a name="max">* <b>_max(x,y)</b></a> - Returns the greater of two values</p>
<p><a name="orient">* <b>_orient(dx,dy)</b></a> - Returns an orientation id (0-8), given x,y directional offsets</p>
<p><a name="facing">* <b>_facing(dx,dy)</b></a> - Returns the orientation id (0-8) most directly facing in the direction of the given x,y vector</p>
<p><a name="ox">* <b>_ox(o)</b></a> - Given an orientation id (0-8), returns its x component offset (-1, 0, 1).  Given an invalid orientation value, the same value is returned.</p>
<p><a name="oy">* <b>_oy(o)</b></a> - Given an orientation id (0-8), returns its y component offset (-1, 0, 1).  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotatecw">* <b>_rotateCW(o)</b></a> - Given an orientation id (0-8), returns the id of the orientation in a clockwise direction.  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotateccw">* <b>_rotateCCW(o)</b></a> - Given an orientation id (0-8), returns the id of the orientation in a counter-clockwise direction.  Given an invalid orientation value, the same value is returned.</p>
<p><a name="rotatedist">* <b>_rotateDist(o1, o2)</b></a> - Give two orientation ids (0-8), returns the number of rotations between them. If either value is invalid, or has a value of 4, returns a value of zero.</p>
<p><a name="dist0">* <b>_dist0(x1,y1,x2,y2)</b></a> - Returns the L-infinity norm (max axial distance) between two 2-D coordinates.</p>
<p><a name="dist1">* <b>_dist1(x1,y1,x2,y2)</b></a> - Returns the L-1 norm (Manhattan distance) between two 2-D coordinates.</p>
<p><a name="dist2">* <b>_dist2(x1,y1,x2,y2)</b></a> - Returns the L-2 norm (Euclidean distance) between two 2-D coordinates.</p>
<p><a name="arrowdir">* <b>_ArrowDir(x,y)</b></a> - Returns the the orientation id (0-8) for the arrow at the room location (x,y). If no arrow is present, returns a value of 4.</p>
<p><a name="roomtile">* <b>_RoomTile(x,y,z)</b></a> - Returns the numeric id of the room tile at (x,y). Use the z parameter to select the tile layer.<br/>
Supported layer values - 0 -> O Layer, 1 -> F Layer, 2 -> T Layer <br/>
Hint: Each layer corresponds to a tab in the editor's tile selection dialog.
</p>
<p><a name="slotitem">* <b>_SlotItem(x,y)</b></a> - Returns the id of the item in the equipment slot at (x,y). If the tile doesn't have an equipment slot, returns -1, and 0 is returned for empty slots.</p>
<p><a name="enemystat">* <b>_EnemyStat(x,y,stat)</b></a> - Returns the stat value of the
  enemy at room location (x,y).  If no enemy is at the current location, the result
  is zero.<br />
  Supported stat values: 0=HP 1=ATK 2=DEF 3=GR 4=REP<br />
  <i>Hint:</i> Use within the value expression of <i>Set monster var</i> to make
  relative offsets to an enemy's stats.<br />
  <i>Example to reduce HP of the enemy at room position (10,10) by 1:</i> Set monster var HP,10,10,_EnemyStat(10, 10, 0) - 1
</p>
<p><a name="monstertype">* <b>_MonsterType(x,y)</b></a> - Returns the numeric monster type of the monster at (x,y). If no monster is present on the tile, -1 is returned.<br/>
Hint: This can be used to compare the monsters in different tiles, or for providing a value for _MyScript injection.
</p>
<p><a name="charactertype">* <b>_CharacterType(x,y)</b></a> - Returns the logical type of the scripted character at (x,y). If no character is present on the tile, -1 is returned.<br/>
  Hint: This can be used to provide a value for _MyScript injection.
</p>

<p><a name="playerinputvars"><b>List of player command input variables</b></a></p>
  Predefined variable names may be provided in texts to output the player's current key binding for the respective command as text. To do this, provide a variable name of the form "$_CMD_&lt;key&gt;$", where &lt;key&gt; is one of the following:
<ul>
<li>MoveNorthwest</li>
<li>MoveNorth</li>
<li>MoveNortheast</li>
<li>MoveWest</li>
<li>Wait</li>
<li>MoveEast</li>
<li>MoveSouthwest</li>
<li>MoveSouth</li>
<li>MoveSoutheast</li>
<li>SwingClockwise</li>
<li>SwingCounterclockwise</li>
<li>Restart</li>
<li>Undo</li>
<li>Battle</li>
<li>UseAccessory</li>
<li>Lock</li>
<li>UseCommand</li>
</ul>

<p><a name="branchingexamples"><b>Examples of branching code structures:</b></a></p>
<ol>
  <li><a name="singlecodebranch">A single code branch:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      <b>If End</b>
  </li>
  <br />
  <li><a name="twocodebranch">Two code branches:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition&gt;<br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      <b>Else</b><br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      <b>If End</b>
  </li>
  <br />
  <li><a name="nestedbranches">Nested branches:</a><br />
      <b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition1&gt;<br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      &nbsp;&nbsp;&nbsp;<b>If ...</b><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;condition2&gt;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;some commands here<br />
      &nbsp;&nbsp;&nbsp;<b>If End</b><br />
      &nbsp;&nbsp;&nbsp;some commands here<br />
      <b>If End</b>
  </li>
</ol>

<p><a name="multichoiceexample"><b>Examples of a multiple choice question:</b></a></p>
<b>Answer option</b> "Attack!",attack<br />
<b>Answer option</b> "Run away!",run<br />
<b>Answer option</b> "Have lunch!",lunch<br />
<b>Question</b> What will you do?<br />
<b>Label</b> attack<br />
Whatever you want the character to do<br />
<b>Goto</b> Done<br />
<b>Label</b> run<br />
Whatever you want the character to do<br />
<b>Goto</b> Done<br />
<b>Label</b> lunch<br />
Whatever you want the character to do<br />
<b>Goto</b> Done<br />
<b>Label</b> Done<br />

<p><a name="newmonsters"><b>How to make a new monster type:</b></a></p>
<ol>
  <li>While editing an NPC script, click "Characters" to go to the
    <a href="customchar.html">Custom Character Management</a> dialog.</li>
  <li>Type in the name of your new monster and click "Add Character".</li>
  <li>Specify its base entity type in the "Graphics" list.</li>
  <li>Click "Edit Default Script" and add <a href="#setvar">Set Var</a> commands
    to the script to define your monster's stats (_MyHP, _MyATK, _MyDEF, _MyGold, _MyREP).</li>
  <li>Add <a href="#imperativelist">Imperatives</a>,
    <a href="#behaviorlist">Behaviors</a>, and other custom scripting if
	desired.</li>
  <li>Import custom tile graphics and an avatar (speech portrait) if needed.
    Otherwise, you might consider setting the _MyColor var to an alternate
	value so your monster doesn't look identical to predefined monster types.</li>
  <li>To place your new monster in your rooms, just place NPCs and set
    them to your new custom type.  They should automatically function according
	to the Default Script you specified for their type.</li>
</ol>

<p><a name="character-on-tarstuff"><b>Character on tarstuff:</b></a></p>
<p>Any Character (whether visible or not) that is standing on any Tarstuff
will lend its own attributes to the Tarstuff.
If the Character is invisible, then the tarstuff is invulnerable.
If the Character is visible and has attackable stats,
then the tarstuff can be stabbed once, which reduces the Character's HP to 0,
but does not kill the Character.
If the Character's HP is restored, then the tarstuff may be stabbed again.
If the Character is killed (via the Imperative Die command or a direct stab),
then the tarstuff can be cut normally.
Essentially, it's being treated as a Tarstuff Mother, although there are certain differences.
</p>

<p><a name="customequipment"><b>How to make custom equipment</b></a></p>
<ol>
  <li>While editing an NPC script, click "Characters" to go to the
    <a href="customchar.html">Custom Character Management</a> dialog.</li>
  <li>Type in the name of your new equipment and click "Add Character".</li>
  <li>To give the player this custom equipment, have an NPC execute 
    "<a href="#equipment">Equipment</a> Swap (type) (equipment name)".</li>
  <li>When this equipment is acquired, the NPC's default script will begin
    running from the start
    as a <a href="#makescriptglobal">global script</a>.
	Click "Edit Default Script" to define how this equipment functions.</li>
  <li>Provide <a href="#setvar">Set Var</a> commands (_MyATK, _MyDEF)
    to the beginning of the script to define
	how the equipment modifies the player's ATK and DEF stats.</li>
  <li>Add <a href="#behaviorlist">Behaviors</a> to determine any special
    attributes the equipment has.  Monster action behaviors are ignored.</li>
  <li>Provide an <a href="#eachuse">Each Use</a> command and matching
    <a href="#label">Label</a> and script segment to define scripting that
	is executed whenever the player activates this item.
	When <a href="#eachattack">Each Attack</a> is executed for a custom weapon,
	script commands after the specified label will be executed each time
	the weapon is used for attack.
	When <a href="#eachdefend">Each Defend</a> is executed for custom armor,
	script commands after the specified label will be called each time
	an enemy attacks the player.</li>
  <li>Add other custom scripting if desired.</li>
  <li>Import a custom tile graphic for the equipment display icon and,
    in the case of weapons, eight directional display tiles.
    If no custom tiles are used, a generic equipment icon is displayed.
	Defining the _MySword var to a valid index will make a custom weapon
	appear as that predefined weapon type.</li>
  <li>The "Graphics" list selection and "Avatar" image are
    irrelevant for custom equipment.</li>
  <li>Place your custom equipment in the room by using the Equipment Generate command.</li>
</ol>

<p><a name="image-overlay-commands"><b>Image overlay commands</b></a></p>
  In addition to selecting an image for display with the "Image overlay" command, you must provide a simple set of commands to define how the image will be displayed in-game.  The list of supported (case-insensitive) commands for use in an Image Overlay script is as follows:<br />
<br />
<b>AddX (pixels)</b> -- shifts the image's X coordinate. Positive values shift to the right, negative values shift to the left.<br />
<b>AddY (pixels)</b> -- shifts the image's Y coordinate. Positive values shift downwards, negative values shift upwards.<br />
<b>CancelAll</b> -- remove all currently displaying image overlay effects. This command is typically run singly.<br />
<b>CancelGroup (group #)</b> -- remove image overlay effects in the specified display group (0 or greater)<br />
<b>CancelLayer (layer #)</b> -- remove image overlay effects on the specified display layer (0 through 3)<br />
<b>Center</b> -- center the image within the room area<br />
<b>Display (ms)</b> -- display the image in its current form for the specified duration<br />
<b>DisplayRect (x) (y) (w) (h)</b> -- show this region of the source image<br />
<b>DisplayRectModify (delta x) (delta y) (delta w) (delta h)</b> -- modifies the display region for the source image<br />
<b>DisplaySize (w) (h)</b> -- show this amount of the source image, in pixels<br />
<b>DisplayTurns (# turns)</b> -- display the image in its current form for the indicated number of game turns<br />
<b>(p)FadeToAlpha (alpha) (ms)</b> -- transition the image from its current alpha value to the indicated value over the specified time interval<br />
<b>Group (group #)</b> -- assign the effect to the given display group (0 or greater). Overlays without a Group command are assigned to Group #0. Only the first instance of this command in a script is executed.<br />
<b>(p)Grow (percent of original) (ms)</b> -- scale the image by the indicated amount over the specified time interval<br />
<b>(p)Jitter (pixels) (ms)</b> -- randomly shake the image off-center up to the indicated range for the specified time interval<br />
<b>Layer (layer)</b> -- place the effect on the indicated display layer (0 through 3, generally corresponding to the menu tabs used for placing game elements in the room editor). Only the first instance of this command in a script is executed.<br />
<b>Loop (times)</b> -- loop through the image command list this many times (-1 = infinite)<br />
<b>(p)Move (x pixels) (y pixels) (ms)</b> -- translate the image's position by the indicated number of pixels over the indicated time interval<br />
<b>(p)MoveTo (x pixel) (y pixel) (ms)</b> -- move the image from its current position to the indicated screen location over the course of the indicated time interval<br />
<b>Repeat (repetions, x, y)</b> -- repeat the final image a positive number of times, with each copy offset from the previous image by x and y pixels, including in negative directions.<br />
<b>(p)Rotate (degrees) (ms)</b> -- rotate the image the indicated amount over the specified time interval<br />
<b>Scale (percent of original)</b> -- scale the image to the indicated amount<br />
<b>SetAlpha (0-255)</b> -- set the image's alpha transparency to the indicated value<br />
<b>SetAngle (degrees)</b> -- set the image's angle of rotation<br />
<b>SetX (pixel)</b> -- set the image's X coordinate<br />
<b>SetY (pixel)</b> -- set the image's Y coordinate<br />
<b>SrcXY (x) (y)</b> - show the source image starting from the indicated pixel position<br />
<b>TileGrid (w) (h)</b> -- replicate the image in a w by h grid. Tiling is not supported for images that have had rotations applied.<br />
<b>TimeLimit (ms)</b> -- set a maximum duration for the overlay to exist. After this time has elapsed, the overlay will end, even if not all commands have been processed. Only the first instance of this command in a script is executed.<br />
<b>TurnLimit (# turns)</b> -- set a maximum number of game turns for the overlay to exist. After that many turns have passed, the overlay will end, even if not all commands have been processed. Only the first instance of this command in a script is executed.<br />
<br />
As an example, you can make an image start invisible, fade in, display for a couple seconds, then fade out by providing the following command sequence:<br />
<br />
setalpha 0 fadetoalpha 255 1000 display 2000 fadetoalpha 0 800<br />
<br />
The text supports variable interpolation, so you can have parameters like "$.ImageX$" in the text. Any part of the command text may be inserted in this fashion.<br />
Certain commands with time duration, marked above, may be optionally prefixed with the letter "p".  This indicates that the command will not run to completion before any subsequent commands are executed, but rather will run in parallel with the next command. Multiple parallel commands may be executed concurrently.<br />

<hr />
<a href="character.html">Character Scripting</a><br />
<a href="scriptarray.html">Script arrays</a><br/>
<a href="editroom.html">Room Editor</a><br />
<a href="editselect.html">Level Editor</a><br />
<a href="contents.html">Contents</a><br />
</body>
</html>
